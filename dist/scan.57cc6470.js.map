{"version":3,"sources":["assets/js/scan.js"],"names":["qr","_","video","intv","stop_scan","srcObject","getTracks","forEach","track","stop","document","getElementById","style","display","status","views","helper","bottom_bar","start_scan","callback","view","navigator","getUserMedia","webkitGetUserMedia","mozGetUserMedia","audio","width","height","stream","querySelector","onloadedmetadata","e","play","barcodeCanvas","createElement","setInterval","videoWidth","videoHeight","barcodeContext","getContext","imageWidth","Math","max","floor","imageHeight","drawImage","imageData","idd","getImageData","data","code","jsQR","console","log","clearInterval","err","name"],"mappings":";AAAA,IAAMA,EAAM,SAACC,GACPC,IAAAA,EACAC,EAmEAC,EAAY,WACCF,EAAMG,UACCC,YAEfC,QAAQ,SAAUC,GACvBA,EAAMC,OACNC,SAASC,eAAe,aAAaC,MAAMC,QAAU,SAGvDX,EAAMG,UAAY,KAClBS,OAAOC,MAAQ,eAEfC,OAAOC,WAAW,KAAM,OAAQ,YAG3B,MAAA,CACLC,WAlFe,SAAUC,GACzBL,OAAOM,KAAO,OAGdV,SAASC,eAAe,aAAaC,MAAMC,QAAU,QAErDQ,UAAUC,aACRD,UAAUC,cACVD,UAAUE,oBACVF,UAAUG,gBAERH,UAAUC,aACZD,UAAUC,aACR,CACEG,OAAO,EACPvB,MAAO,CACLwB,MAAO,IACPC,OAAQ,MAGZ,SAAUC,IACR1B,EAAQQ,SAASmB,cAAc,UACzBxB,UAAYuB,EAElB1B,EAAM4B,iBAAmB,SAAUC,GACjC7B,EAAM8B,OAEFC,IAAAA,EAAgBvB,SAASwB,cAAc,UAC3C/B,EAAOgC,YAAY,WACjBF,EAAcP,MAAQxB,EAAMkC,WAC5BH,EAAcN,OAASzB,EAAMmC,YACzBC,IAAAA,EAAiBL,EAAcM,WAAW,MAC1CC,EAAaC,KAAKC,IAAI,EAAGD,KAAKE,MAAMzC,EAAMkC,aAC5CQ,EAAcH,KAAKC,IAAI,EAAGD,KAAKE,MAAMzC,EAAMmC,cAE7CC,EAAeO,UAAU3C,EAAO,EAAG,EAAGsC,EAAYI,GAE9CE,IAMAC,EANYT,EAAeU,aAC7B,EACA,EACAR,EACAI,GAEkBK,KAEhBC,EAAOC,KAAKJ,EAAKP,EAAYI,GACjCQ,QAAQC,IAAIH,GAERA,IACF9C,IACAe,EAAS+B,EAAKD,MACdnC,OAAOM,KAAO,eACdkC,cAAcnD,KAEf,OAGP,SAAUoD,GACRH,QAAQC,IAAI,iCAAmCE,EAAIC,QAIvDJ,QAAQC,IAAI,+BAqBdjD,UAAAA,GAtFQ","file":"scan.57cc6470.js","sourceRoot":"../application","sourcesContent":["const qr = ((_) => {\n  let video;\n  let intv;\n  let start_scan = function (callback) {\n    status.view = \"scan\";\n    //helper.bottom_bar(\"\", \"\", \"\");\n\n    document.getElementById(\"qr-screen\").style.display = \"block\";\n\n    navigator.getUserMedia =\n      navigator.getUserMedia ||\n      navigator.webkitGetUserMedia ||\n      navigator.mozGetUserMedia;\n\n    if (navigator.getUserMedia) {\n      navigator.getUserMedia(\n        {\n          audio: false,\n          video: {\n            width: 200,\n            height: 200,\n          },\n        },\n        function (stream) {\n          video = document.querySelector(\"video\");\n          video.srcObject = stream;\n\n          video.onloadedmetadata = function (e) {\n            video.play();\n\n            var barcodeCanvas = document.createElement(\"canvas\");\n            intv = setInterval(() => {\n              barcodeCanvas.width = video.videoWidth;\n              barcodeCanvas.height = video.videoHeight;\n              var barcodeContext = barcodeCanvas.getContext(\"2d\");\n              var imageWidth = Math.max(1, Math.floor(video.videoWidth)),\n                imageHeight = Math.max(1, Math.floor(video.videoHeight));\n\n              barcodeContext.drawImage(video, 0, 0, imageWidth, imageHeight);\n\n              var imageData = barcodeContext.getImageData(\n                0,\n                0,\n                imageWidth,\n                imageHeight\n              );\n              var idd = imageData.data;\n\n              let code = jsQR(idd, imageWidth, imageHeight);\n              console.log(code);\n\n              if (code) {\n                stop_scan();\n                callback(code.data);\n                status.view = \"subscription\";\n                clearInterval(intv);\n              }\n            }, 1000);\n          };\n        },\n        function (err) {\n          console.log(\"The following error occurred: \" + err.name);\n        }\n      );\n    } else {\n      console.log(\"getUserMedia not supported\");\n    }\n  };\n\n  let stop_scan = function () {\n    const stream = video.srcObject;\n    const tracks = stream.getTracks();\n\n    tracks.forEach(function (track) {\n      track.stop();\n      document.getElementById(\"qr-screen\").style.display = \"none\";\n    });\n\n    video.srcObject = null;\n    status.views = \"subscription\";\n\n    helper.bottom_bar(\"QR\", \"save\", \"chancel\");\n  };\n\n  return {\n    start_scan,\n    stop_scan,\n  };\n})();\n"]}