{"version":3,"sources":["index.js"],"names":["self","months","weekday","today","Date","currentMonth","getMonth","currentYear","getFullYear","currentDay","getDate","monthAndYear","document","getElementById","once","status","view","selected_day","visible","update_event_id","settings","blob","events","getManifest","callback","navigator","mozApps","getSelf","onsuccess","result","onerror","manifest","a","origin","t","installOrigin","querySelector","src","console","log","style","display","find_closest_date","search_term","search","getTime","i","length","dateStart","querySelectorAll","focus","event_check","date","feedback","event","subscription","multidayevent","rrule","b","dateEnd","c","isSubscription","rrule_check","undefined","rrule_","getDay","tt","pp","slider","slider_index","event_check_day","k","innerHTML","elements","item","getAttribute","d","push","insertAdjacentHTML","opacity","slider_navigation","p","forEach","classList","remove","add","jump_to_today","showCalendar","activeElement","next","previous","prototype","getWeek","setHours","setDate","week1","Math","round","month","year","helper","bottom_bar","firstDay","daysInMonth","tbl","row","createElement","j","cell","cellText","createTextNode","appendChild","span","moon","setAttribute","mmonth","slice","getMoonPhase","toISOString","week","weekText","set_tabindex","renderHello","arr","sort_array","template","rendered","Mustache","render","data","index","n","m","contains","innerText","clear_form","Array","from","e","value","add_edit_event","list_view","options","option_button_bar","setTimeout","pages","router","hasAttribute","edit_event","default_notification","articles","success","rect","getBoundingClientRect","elY","top","body","height","parentNode","scrollBy","left","window","innerHeight","behavior","eximport","list_ics","list_subscriptions","subscriptions","name","lp","load_subscriptions","lenght","fetch_ics","url","toaster","callback_scan","store_subscription","validate","val","localforage","setItem","then","catch","err","delete_subscription","updated_subscriptions","filter","handleVisibilityChange","visibilityState","getItem","nav","move","nodeName","type","currentIndex","tabIndex","items","firstElementChild","targetElement","selected_day_id","id","addEventListener","parentElement","l","add_alarm","message_text","mozAlarms","foo","event_id","request","error","remove_alarm","getAll","alarm","req","test_alarm","respectTimezone","JSON","stringify","convert_ics_date","nn","replace","export_data","store_event","start_time","end_time","convert_dt_start","convert_dt_end","calc_notification","notification_time","setMinutes","getMinutes","rrule_convert","r","UID","uid","SUMMARY","LOCATION","DESCRIPTION","CLASS","DTSTAMP","DTSTART","DTEND","RRULE","time_start","time_end","alarmTrigger","ATTACH","BEGIN","ACTION","END","without_subscription","export_ical","update_event","delete_event","person","f","y","timeout","import_event","set_datetime_form","getHours","d_h_","pick_image_callback","resultBlob","URL","createObjectURL","fr","FileReader","onload","readAsDataURL","longpress","longpress_timespan","repeat_action","param","key","longpress_action","close","shortpress_action","toggle","qr","start_scan","children","pick_image","loadICS","tagName","views","handleKeyDown","evt","preventDefault","repeat","handleKeyUp","clearTimeout","serviceWorker","register","reg","scope"],"mappings":";AAAA,aA6yDA,SAAA,EAAA,GAAA,OAAA,EAAA,mBAAA,QAAA,iBAAA,OAAA,SAAA,SAAA,GAAA,cAAA,GAAA,SAAA,GAAA,OAAA,GAAA,mBAAA,QAAA,EAAA,cAAA,QAAA,IAAA,OAAA,UAAA,gBAAA,IAAA,GA3yDE,IAmDIA,EAnDAC,EAAS,CACX,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,MACA,OAGEC,EAAU,CAAC,MAAO,MAAO,MAAO,MAAO,MAAO,MAAO,OAErDC,EAAQ,IAAIC,KACZC,EAAeF,EAAMG,WACrBC,EAAcJ,EAAMK,cACpBC,EAAaN,EAAMO,UACnBC,EAAeC,SAASC,eAAe,gBAEvCC,GAAO,EAEPC,EAAS,CACXC,KAAM,QACNC,aAAc,GACdC,SAAS,EACTC,gBAAiB,IAGfC,EAAW,GAEXC,EAAO,GACPC,EAAS,GAKTC,EAAc,SAAUC,GACtB,IAACC,UAAUC,QACN,OAAA,EAEL1B,IAAAA,EAAOyB,UAAUC,QAAQC,UAC7B3B,EAAK4B,UAAY,WACfJ,EAASxB,EAAK6B,SAEhB7B,EAAK8B,QAAU,cAKjB,SAASC,EAASC,GAChBhC,EAAOgC,EAAEC,OACLC,IAAAA,EAAItB,SAASC,eAAe,oBACT,kCAAnBmB,EAAEG,cACJvB,SAASwB,cAAc,4BAA4BC,IAAM,YAEzDC,QAAQC,IAAI,YACZL,EAAEM,MAAMC,QAAU,QAItBlB,EAAYQ,GAMZ,IAAIW,EAAoB,SAAUC,GAI3B,IAHDT,IAAAA,EAAI,EACJU,EAAS,IAAIxC,KAAKuC,GAAaE,UAE1BC,EAAI,EAAGA,EAAIxB,EAAOyB,OAAQD,IAAK,CAGlCF,EAFO,IAAIxC,KAAKkB,EAAOwB,GAAGE,WAAWH,YAGvCX,EAAIZ,EAAOwB,EAAI,GAAGE,UAClBF,EAAIxB,EAAOyB,QAITH,EAAS,IAAIxC,KAAKkB,EAAOA,EAAOyB,OAAS,GAAGC,WAAWH,YACzDX,EAAIZ,EAAOA,EAAOyB,OAAS,GAAGC,UAC9BF,EAAIxB,EAAOyB,QAMRb,OAHPtB,SACGqC,iBAAiB,oCAAsCf,EAAI,MAAM,GACjEgB,QACIhB,GAILiB,EAAc,SAAUC,GASrB,IARDC,IAAAA,EAAW,CACbD,KAAM,GACNE,OAAO,EACPC,cAAc,EACdC,eAAe,EACfC,MAAO,QAGAvB,EAAI,EAAGA,EAAIZ,EAAOyB,OAAQb,IAC7B,GAAqB,WAArB,EAAOZ,EAAOY,IAAiB,CACjCmB,EAASC,OAAQ,EACjBD,EAASE,cAAe,EACxBF,EAASG,eAAgB,EACzBH,EAASI,OAAQ,EACjBJ,EAASD,KAAOA,EAEZpB,IAAAA,EAAI,IAAI5B,KAAKkB,EAAOY,GAAGc,WAAWH,UAClCa,EAAI,IAAItD,KAAKkB,EAAOY,GAAGyB,SAASd,UAChCe,EAAI,IAAIxD,KAAKgD,GAAMP,UAGI,QAAvBvB,EAAOY,GAAP,SACEF,IAAM4B,GAAKF,IAAME,GAAM5B,EAAI4B,GAAKF,EAAIE,KACtCP,EAASC,OAAQ,GACgB,IAA7BhC,EAAOY,GAAG2B,iBACZR,EAASE,cAAe,IAGM,IAA5BjC,EAAOY,GAAGsB,gBACZH,EAASG,eAAgB,GAE3BtB,EAAIZ,EAAOyB,QAKZM,OAAAA,GAILS,EAAc,SAAUV,GASrB,IARDC,IAAAA,EAAW,CACbD,KAAM,GACNE,OAAO,EACPC,cAAc,EACdC,eAAe,EACfC,MAAO,QAGAvB,EAAI,EAAGA,EAAIZ,EAAOyB,OAAQb,IAC7B,GAAqB,WAArB,EAAOZ,EAAOY,IAAiB,CACjCmB,EAASC,OAAQ,EACjBD,EAASE,cAAe,EACxBF,EAASG,eAAgB,EACzBH,EAASI,OAAQ,EACjBJ,EAASD,KAAOA,EAER,IAAIhD,KAAKkB,EAAOY,GAAGc,WAAWH,UAC9B,IAAIzC,KAAKkB,EAAOY,GAAGyB,SAASd,UAC5B,IAAIzC,KAAKgD,GAAMP,UAKrB,QAA+B,IAAxBvB,EAAOY,GAAP,aACiB6B,IAAxBzC,EAAOY,GAAP,QAGE,IAAI9B,KAAKkB,EAAOY,GAAGc,WAAWH,WAC5B,IAAIzC,KAAKgD,GAAMP,WACjB,IAAIzC,KAAKgD,GAAMP,WAAa,IAAIzC,KAAKkB,EAAOY,GAAGyB,SAASd,UACxD,CACIvB,GAAoB,WAApBA,EAAOY,GAAG8B,QAEV,IAAI5D,KAAKkB,EAAOY,GAAGc,WAAWtC,YAC9B,IAAIN,KAAKgD,GAAM1C,UAIR2C,OAFPA,EAASI,OAAQ,EACjBvB,EAAIZ,EAAOyB,OACJM,EAIP/B,GAAuB,SAAvBA,EAAOY,GAAP,OAGKmB,OAFPA,EAASI,OAAQ,EACjBvB,EAAIZ,EAAOyB,OACJM,EAGL/B,GAAoB,UAApBA,EAAOY,GAAG8B,QAEV,IAAI5D,KAAKkB,EAAOY,GAAGc,WAAWiB,WAC9B,IAAI7D,KAAKgD,GAAMa,SAIRZ,OAFPA,EAASI,OAAQ,EACjBvB,EAAIZ,EAAOyB,OACJM,EAIP/B,GAAoB,UAApBA,EAAOY,GAAG8B,OAAoB,CAC5BE,IAAAA,EAAK,IAAI9D,KAAKkB,EAAOY,GAAGc,WACxBmB,EAAK,IAAI/D,KAAKgD,GAGhBc,GAAAA,EAAGxD,UAAY,IAAMwD,EAAG5D,YACxB6D,EAAGzD,UAAY,IAAMyD,EAAG7D,WAIjB+C,OAFPA,EAASI,OAAQ,EACjBvB,EAAIZ,EAAOyB,OACJM,IAOZA,OAAAA,GAOLe,EAAS,GACTC,EAAe,EAEfC,EAAkB,SAAUlB,GAC9BgB,EAAS,GACLG,IAAAA,EAAI3D,SAASwB,cAAc,kCAC/BmC,EAAEC,UAAY,GAGT,IADDC,IAAAA,EAAW7D,SAASqC,iBAAiB,4BAChCH,EAAI,EAAGA,EAAI2B,EAAS1B,OAAQD,IACnC2B,EAAS3B,GAAGN,MAAMC,QAAU,OAKzB,IAFDiC,IAAAA,EAAO9D,SAASqC,iBAAiB,4BAE5BH,EAAI,EAAGA,EAAI4B,EAAK3B,OAAQD,IAAK,CAChCd,IAAAA,EAAI,IAAI5B,KAAKsE,EAAK5B,GAAG6B,aAAa,cAAc9B,UAChDa,EAAI,IAAItD,KAAKsE,EAAK5B,GAAG6B,aAAa,kBAAkB9B,UACpDe,EAAI,IAAIxD,KAAKgD,GAAMP,UACnB+B,EAAIF,EAAK5B,GAAG6B,aAAa,cAEzBC,GAAM,SAANA,GAAsB,KAANA,GACd5C,IAAM4B,GAAKF,IAAME,GAAM5B,EAAI4B,GAAKF,EAAIE,KACtCQ,EAAOS,KAAKH,EAAK5B,IACjBsB,EAAO,GAAG5B,MAAMC,QAAU,QAE1B8B,EAAEO,mBAAmB,YAAa,uCAGhC9C,GAAAA,IAAM4B,GAAKF,IAAME,GAAM5B,EAAI4B,GAAKF,EAAIE,GAAKgB,EAAI,CAG3CA,GAAK,UAALA,EAAe,CACbV,IAAAA,EAAK,IAAI9D,KAAKsE,EAAK5B,GAAG6B,aAAa,cACnCR,EAAK,IAAI/D,KAAKgD,GAGhBc,EAAGxD,UAAY,IAAMwD,EAAG5D,YACxB6D,EAAGzD,UAAY,IAAMyD,EAAG7D,aAExB8D,EAAOS,KAAKH,EAAK5B,IACjBsB,EAAO,GAAG5B,MAAMC,QAAU,QAE1B8B,EAAEO,mBACA,YACA,kCAMG,UAALF,GAEA,IAAIxE,KAAKsE,EAAK5B,GAAG6B,aAAa,cAAcV,UAC5C,IAAI7D,KAAKgD,GAAMa,WAEfG,EAAOS,KAAKH,EAAK5B,IACjBsB,EAAO,GAAG5B,MAAMC,QAAU,QAE1B8B,EAAEO,mBACA,YACA,kCAOG,WAALF,GAEA,IAAIxE,KAAKsE,EAAK5B,GAAG6B,aAAa,cAAcjE,WAC5C,IAAIN,KAAKgD,GAAM1C,YAEf0D,EAAOS,KAAKH,EAAK5B,IACjBsB,EAAO,GAAG5B,MAAMC,QAAU,QAE1B8B,EAAEO,mBACA,YACA,kCAKG,SAALF,IACE5C,IAAM4B,GAAKF,IAAME,GAAM5B,EAAI4B,GAAKF,EAAIE,KACtCQ,EAAOS,KAAKH,EAAK5B,IACjBsB,EAAO,GAAG5B,MAAMC,QAAU,QAE1B8B,EAAEO,mBACA,YACA,mCAOE,IAAVV,GAAgBA,EAAOrB,OAAS,EAClCwB,EAAE/B,MAAMuC,QAAU,IAElBR,EAAE/B,MAAMuC,QAAU,GAIlBC,EAAoB,WAClBC,IAAAA,EAAIrE,SAASqC,iBAAiB,sCAC9BoB,GAAgBD,EAAOrB,OAAS,IAClCsB,GAAgB,GAElBA,IACAD,EAAOc,QAAQ,SAAUR,GACvBA,EAAKlC,MAAMC,QAAU,SAEvB2B,EAAOC,GAAc7B,MAAMC,QAAU,QACrCwC,EAAEC,QAAQ,SAAUR,GAClBA,EAAKS,UAAUC,OAAO,YAExBH,EAAEZ,GAAcc,UAAUE,IAAI,WAS5BC,EAAgB,WACdjF,IAAAA,EAAeF,EAAMG,WACrBC,EAAcJ,EAAMK,cACxB+E,EAAalF,EAAcE,GAC3B+B,QAAQC,IAAIlC,GAEZiE,EAAgBvD,EAAOE,cACvBF,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,cAG5D,SAASc,IACPlF,EAA+B,KAAjBF,EAAsBE,EAAc,EAAIA,EAEtDgF,EADAlF,GAAgBA,EAAe,GAAK,GACTE,GAC3B+D,EAAgBvD,EAAOE,cAGzB,SAASyE,IACPnF,EAA+B,IAAjBF,EAAqBE,EAAc,EAAIA,EAErDgF,EADAlF,EAAgC,IAAjBA,EAAqB,GAAKA,EAAe,EAC7BE,GAC3B+D,EAAgBvD,EAAOE,cAQzBb,KAAKuF,UAAUC,QAAU,WACnBxC,IAAAA,EAAO,IAAIhD,KAAK,KAAKyC,WACzBO,EAAKyC,SAAS,EAAG,EAAG,EAAG,GAGvBzC,EAAK0C,QAAQ1C,EAAK1C,UAAY,GAAM0C,EAAKa,SAAW,GAAK,GAGrD8B,IAAAA,EAAQ,IAAI3F,KAAKgD,EAAK5C,cAAe,EAAG,GAI1C,OAAA,EACAwF,KAAKC,QACD7C,EAAKP,UAAYkD,EAAMlD,WAAa,MACpC,GACEkD,EAAM9B,SAAW,GAAK,GACxB,IAKR,IAAIsB,EAAe,SAAUW,EAAOC,GAClCC,OAAOC,WAAW,MAAO,SAAU,WAE/BC,IAAAA,EAAW,IAAIlG,KAAK+F,EAAMD,GAAOjC,SACjCsC,EAAc,GAAK,IAAInG,KAAK+F,EAAMD,EAAO,IAAIxF,UAE7C8F,EAAM5F,SAASC,eAAe,iBAGlC2F,EAAIhC,UAAY,GAGhB7D,EAAa6D,UAAYvE,EAAOiG,GAAS,IAAMC,EAI1C,IADD/C,IAAAA,EAAO,EACFN,EAAI,EAAGA,EAAI,EAAGA,IAAK,CAEtB2D,IAAAA,EAAM7F,SAAS8F,cAAc,OACjCD,EAAItB,UAAUE,IAAI,QAClBoB,EAAItB,UAAUE,IAAI,OAClBoB,EAAItB,UAAUE,IAAI,aAGb,IAAA,IAAIsB,EAAI,EAAGA,EAAI,EAAGA,IACjB7D,GAAM,IAANA,GAAW6D,EAAIL,EAAU,CACvBM,IAAAA,EAAOhG,SAAS8F,cAAc,OAC9BG,EAAWjG,SAASkG,eAAe,IACvCF,EAAKG,YAAYF,GACjBJ,EAAIM,YAAYH,OACX,CAAA,GAAIxD,EAAOmD,EAChB,MAEIK,IAAAA,EAAOhG,SAAS8F,cAAc,OAC9BM,EAAOpG,SAAS8F,cAAc,QAC9BO,EAAOrG,SAAS8F,cAAc,OAE9BG,EAAWjG,SAASkG,eAAe1D,GACvCwD,EAAKG,YAAYF,GACjBD,EAAKG,YAAYC,GAGjBJ,EAAKM,aAAa,WAAY9D,EAAO,GAKjC+D,IAGAlC,EAAIkB,EAAO,IAHF,IAAID,OAAAA,EAAQ,GAAIkB,OAAO,GAGN,IAFpB,IAAIhE,OAAAA,GAAOgE,OAAO,GAI5BH,EAAK9B,UAAUE,IAAI,cAAgBgC,aAAalB,EAAMD,EAAO9C,IAC7DwD,EAAKG,YAAYE,GAEjBL,EAAKM,aAAa,YAAajC,GAE/B2B,EAAKM,aAAa,aAAc,IAAI9G,KAAK6E,GAAGqC,eAGxChG,EAAOyB,OAAS,IACdI,EAAY8B,GAAG3B,OACjBsD,EAAKzB,UAAUE,IAAI,SAGjBvB,EAAYmB,GAAGxB,OACjBmD,EAAKzB,UAAUE,IAAI,SAIc,GAA/BlC,EAAY8B,GAAG1B,cACjBqD,EAAKzB,UAAUE,IAAI,iBAIvBuB,EAAKzB,UAAUE,IAAI,QACnBoB,EAAIM,YAAYH,GAEhBxD,IAKAmE,IAAAA,EAAO3G,SAAS8F,cAAc,QAClCa,EAAKpC,UAAUE,IAAI,cAEfmC,IAAAA,EAAW5G,SAASkG,eACtB,IAAI1G,KAAK+F,EAAMD,EAAO9C,GAAMwC,WAG9B2B,EAAKR,YAAYS,GACjBf,EAAIM,YAAYQ,GAGhBf,EAAIO,YAAYN,GAGlB7F,SAASqC,iBAAiB,SAAS,GAAGC,QACtCnC,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,aAGtDxE,EAAMG,YAAc4F,GAAS/F,EAAMK,eAAiB2F,IACtDvF,SAASqC,iBAAiB,SAASxC,EAAa,GAAGyC,QACnDtC,SAASqC,iBAAiB,SAASxC,EAAa,GAAG0E,UAAUE,IAAI,WAIjEoC,EAAe,WACjB7G,SAASqC,iBAAiB,yBAAyBiC,QAAQ,SAAUpC,EAAGmC,GACtEnC,EAAEoE,aAAa,WAAYjC,MAM/B,SAASyC,EAAYC,GACnB/G,SAASC,eAAe,gBAAgB2B,MAAMuC,QAAU,EACxDqB,OAAOwB,WAAWD,EAAK,YAAa,QAEhCE,IAAAA,EAAWjH,SAASC,eAAe,YAAY2D,UAC/CsD,EAAWC,SAASC,OAAOH,EAAU,CAAEI,KAAMN,IACjD/G,SAASC,eAAe,aAAa2D,UAAYsD,EACjDlH,SAASC,eAAe,gBAAgB2D,UAAYsD,EACpDlH,SAASC,eAAe,gBAAgB2B,MAAMuC,QAAU,IAExD0C,IAIA7G,SAASqC,iBAAiB,WAAWiC,QAAQ,SAAUgD,GACjDhG,IAAAA,EAAI,IAAI9B,KAAK8H,EAAMvD,aAAa,cAChCwD,EAAI,IAAI/H,KAAK8H,EAAMvD,aAAa,kBAEhCC,EACF1E,EAAQgC,EAAE+B,UACV,KACA/B,EAAE1B,cACF,IACAP,EAAOiC,EAAE5B,YACT,IACA4B,EAAExB,UAEA0H,EACFlI,EAAQiI,EAAElE,UACV,KACAkE,EAAE3H,cACF,IACAP,EAAOkI,EAAE7H,YACT,IACA6H,EAAEzH,UAGAwH,EAAM/C,UAAUkD,SAAS,iBAC3BH,EAAM9F,cAAc,YAAYkG,UAAY1D,EAAI,MAAQwD,EAExDF,EAAM9F,cAAc,YAAYkG,UAAY1D,IAMlD,IAAI2D,EAAa,WACfC,MAAMC,KAAK7H,SAASqC,iBAAiB,6BAA6BiC,QAChE,SAAUwD,GACRA,EAAEC,MAAQ,GACV/H,SAASC,eAAe,cAAcwB,IAAM,GAC5ChB,EAAO,MAeP6E,EAAQtF,SAASC,eAAe,YAChC+H,EAAiBhI,SAASC,eAAe,kBACzCgI,EAAYjI,SAASC,eAAe,aACpCiI,EAAUlI,SAASC,eAAe,WAEpCkI,EAAoB,WACtBC,WAAW,WACLjI,GAAe,WAAfA,EAAOC,KAEPJ,MAAwD,gBAAxDA,SAAS4E,cAAcb,aAAa,kBAEpCyB,OAAOC,WAAW,SAAU,SAAU,KAC/B,IAEPD,OAAOC,WAAW,GAAI,SAAU,KACzB,IAGV,MAGC4C,EAAQrI,SAASqC,iBAAiB,SAEpCiG,EAAS,SAAUlI,GAcjBD,GAbJyH,MAAMC,KAAKQ,GAAO/D,QAAQ,SAAUgD,GAClCA,EAAM1F,MAAMC,QAAU,SAGZ,QAARzB,IACiB,SAAfD,EAAOC,KACTD,EAAOC,KAAO,YAEdD,EAAOC,KAAO,SAKC,kBAAfD,EAAOC,KA+BF,OA9BHJ,SAAS4E,cAAc2D,aAAa,eACtCpI,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,cAE5D/D,SAASC,eAAe,cAAc8H,MAAQ5H,EAAOE,aAErD2H,EAAepG,MAAMC,QAAU,QAC/B+F,MAAMC,KAAK7H,SAASqC,iBAAiB,6BAA6BiC,QAChE,SAAUpC,EAAGmC,GACXnC,EAAEoE,aAAa,WAAYjC,KAG/B2D,EAAe3F,iBAAiB,SAAS,GAAGC,QAC5CkD,OAAOC,WAAW,GAAI,OAAQ,IAEyB,IAAnDzF,SAASC,eAAe,kBAAkB8H,QAC5C/H,SAASC,eAAe,kBAAkB8H,MACxC/H,SAASC,eAAe,cAAc8H,OAGtC5H,EAAOqI,aACTxI,SAASC,eAAe,cAAcyH,UAAY,UAEpDhG,QAAQC,IAAIxB,EAAOqI,YAEdrI,EAAOqI,aACVxI,SAASC,eAAe,cAAcyH,UAAY,OAElD1H,SAASC,eAAe,2BAA2B8H,MACjDvH,EAASiI,uBAEN,EAILtI,GAAe,SAAfA,EAAOC,KAAiB,CACtBJ,SAAS4E,cAAc2D,aAAa,eACtCpI,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,cAE5DmE,EAAQtG,MAAMC,QAAU,OACxByD,EAAM1D,MAAMC,QAAU,QACtB2D,OAAOC,WAAW,MAAO,SAAU,WACnCtF,EAAOqI,YAAa,EAEhBlH,IAAAA,EAAI,IAAI9B,KAAKW,EAAOE,cACxBZ,EAAe6B,EAAE5B,WACjBC,EAAc2B,EAAE1B,cAEZ+D,IAAAA,EAAIxD,EAAOE,aACfsE,EAAalF,EAAcE,GAE3BiI,MAAMC,KACJ7H,SAASqC,iBAAiB,+BAC1BiC,QAAQ,SAAUR,GACdA,EAAKC,aAAa,cAAgBJ,IACpCG,EAAKxB,QACLoB,EAAgBC,MAIpBgE,IAIiB,aAAfxH,EAAOC,OACLJ,SAAS4E,cAAc2D,aAAa,eACtCpI,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,cAE5DmE,EAAQtG,MAAMC,QAAU,OACxB1B,EAAOqI,YAAa,EACpBb,IAEAnC,OAAOC,WAAW,OAAQ,QAAS,WAEnCwC,EAAUrG,MAAMC,QAAU,QAC1BuG,WAAW,WAIJ,IAHDM,IAAAA,EAAW1I,SAASqC,iBAAiB,yBAErCsG,GAAU,EACLhF,EAAI,EAAGA,EAAI+E,EAASvG,OAAQwB,IAC/B+E,EAAS/E,GAAGI,aAAa,cAAgB5D,EAAOE,eAClDqI,EAAS/E,GAAGrB,QACZqB,EAAI+E,EAASvG,OACbwG,GAAU,GAIT,IAAIhF,EAAI,EAAGA,EAAI+E,EAASvG,OAAQwB,IACnCjC,QAAQC,IAAI+G,EAAS/E,GAAGI,aAAa,eACS,QAA1C2E,EAAS/E,GAAGI,aAAa,gBAC3B2E,EAAS/E,GAAGnC,cAAc,YAAYI,MAAMC,QAAU,QAErD8G,IACH3I,SAASqC,iBAAiB,yBAAyB,GAAGC,QACtDR,EAAkB3B,EAAOE,eAErBuI,IAAAA,EAAO5I,SAAS4E,cAAciE,wBAC9BC,EACJF,EAAKG,IACL/I,SAASgJ,KAAKH,wBAAwBE,IACtCH,EAAKK,OAAS,EAEhBjJ,SAAS4E,cAAcsE,WAAWC,SAAS,CACzCC,KAAM,EACNL,IAAKD,EAAMO,OAAOC,YAAc,EAChCC,SAAU,YAEX,MAEc,WAAfpJ,EAAOC,OACLJ,SAAS4E,cAAc2D,aAAa,eACtCpI,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,cAEvD7D,IACHsJ,SAASC,WACTC,IACAxJ,GAAO,GAGTF,SAASC,eAAe,WAAW2B,MAAMC,QAAU,QACnD7B,SAASqC,iBAAiB,qBAAqB,GAAGC,QAClDtC,SAASC,eAAe,WAAW2B,MAAMuC,QAAU,IACnDnE,SAASC,eAAe,qBAAqB2B,MAAMC,QAAU,OAC7DuG,WAAW,WACTR,MAAMC,KAAK7H,SAASqC,iBAAiB,sBAAsBiC,QACzD,SAAUpC,EAAGmC,GACXnC,EAAEoE,aAAa,WAAYjC,MAG9B,KAEH8D,KAGiB,gBAAfhI,EAAOC,OACTJ,SAASC,eAAe,WAAW2B,MAAMuC,QAAU,MACnDnE,SAASC,eAAe,qBAAqB2B,MAAMC,QAAU,QAE7D7B,SACGqC,iBAAiB,wCAAwC,GACzDC,QAEHkD,OAAOC,WAAW,KAAM,GAAI,UAI5BiE,EAAqB,WACnBC,GAAiB,MAAjBA,EAAuB,OAAO,EAElCA,EAAcrF,QAAQ,SAAUR,GAC9B9D,SACGwB,cAAc,qCACd0C,mBACC,WACA,6DACEJ,EAAK8F,KACL,aAGNhC,MAAMC,KAAK7H,SAASqC,iBAAiB,uBAAuBiC,QAC1D,SAAUpC,EAAGmC,GACXnC,EAAEoE,aAAa,WAAYjC,QAM/BwF,EAAK,EACLC,EAAqB,SAArBA,IAEAH,GAAiB,MAAjBA,IACyB,GAAzBA,EAAcI,QACU,aAAxBJ,EAAcI,OAEd,OAAO,EAELF,EAAKF,EAAcxH,SACrBqH,SAASQ,UAAUL,EAAcE,GAAII,IAAKH,GAC1CD,IACArE,OAAO0E,QAAQ,uBAAwB,MAGzCxF,IAEAoC,EAAYpG,GAEZgD,EAAgB1D,SAAS4E,cAAcb,aAAa,cAChD/D,SAAS4E,cAAc2D,aAAa,eACtCpI,EAAOE,aAAeL,SAAS4E,cAAcb,aAAa,eAG1DoG,EAAgB,SAAUF,GAC5BzE,OAAOC,WAAW,KAAM,OAAQ,UAChCzF,SAASwB,cAAc,4CAA4CuG,MACjEkC,GAEAN,EAAgB,IAAI/B,MACpBwC,EAAqB,WACvB1I,QAAQC,IAAIgI,GAGVnE,OAAO6E,SAASrK,SAASC,eAAe,gBAAgB8H,QACN,IAAlD/H,SAASC,eAAe,iBAAiB8H,QAEzC4B,EAAgB,IACF1F,KAAK,CACjBgG,IAAKjK,SAASC,eAAe,gBAAgB8H,MAC7C6B,KAAM5J,SAASC,eAAe,iBAAiB8H,QAGjD/H,SAASwB,cAAc,uBAAuB8I,IAAM,GACpDtK,SAASwB,cAAc,sBAAsB8I,IAAM,GAEnDC,YACGC,QAAQ,gBAAiBb,GACzBc,KAAK,SAAU1C,GACd/H,SAASC,eAAe,qBAAqB2B,MAAMC,QAAU,OAC7D2D,OAAO0E,QAAQ,sBAAuB,KACtC/J,EAAOC,KAAO,UACdkI,MAEDoC,MAAM,SAAUC,GAEfjJ,QAAQC,IAAIgJ,KAEhBb,IACAJ,KAEAlE,OAAO0E,QAAQ,sCAAuC,MAItDU,EAAsB,WACpBC,IAAAA,EAAwBlB,EAAcmB,OACxC,SAAChD,GAAMA,OAAAA,EAAE8B,MAAQ5J,SAAS4E,cAAc8C,YAG1C6C,YACGC,QAAQ,gBAAiBK,GACzBJ,KAAK,SAAU1C,GAEdrG,QAAQC,IAAI,UAAYoG,GACxBvC,OAAO0E,QAAQ,uBAAwB,KACvC/J,EAAOC,KAAO,QACdkI,MAEDoC,MAAM,SAAUC,GAEfnF,OAAO0E,QAAQS,EAAK,OAGxB3K,SAAS4E,cAAcJ,UA4CzB,SAASuG,IAC0B,WAA7B/K,SAASgL,gBACX7K,EAAOG,SAAU,EAEjB8H,WAAW,WACTjI,EAAOG,SAAU,GAChB,KA/CPiK,YACGU,QAAQ,UACRR,KAAK,SAAU1C,GACD,MAATA,IAAerH,EAASqH,GAE5BjB,EAAYpG,GACZgE,MAEDgG,MAAM,SAAUC,GACfjG,MAGJ6F,YACGU,QAAQ,iBACRR,KAAK,SAAU1C,GACd4B,EAAgB5B,EAEhBK,WAAW,WACLuB,GAAiB,MAAjBA,EAAuB,OAAO,EAClCG,IACApI,QAAQC,IAAIgI,IACX,OAEJe,MAAM,SAAUC,GAEfjJ,QAAQC,IAAIgJ,KAGhBJ,YACGU,QAAQ,YACRR,KAAK,SAAU1C,GACVA,GAAS,MAATA,EAAe,OAAO,EAC1BvH,EAAWuH,EACX/H,SAASC,eAAe,6BAA6B8H,MACnDvH,EAASiI,uBAEZiC,MAAM,SAAUC,GAEfjJ,QAAQC,IAAIgJ,KAahBI,IAMA,IAAIG,EAAM,SAAUC,GAEhBnL,GAAmC,UAAnCA,SAAS4E,cAAcwG,UACQ,QAA/BpL,SAAS4E,cAAcyG,MACQ,QAA/BrL,SAAS4E,cAAcyG,KAEvB,OAAO,EACHC,IACFzG,EADiB7E,SAAS4E,cAAc2G,SAClBJ,EACtBK,EAAQ,EAEO,SAAfrL,EAAOC,OAEToL,EADQxL,SAAS4E,cAAcsE,WAAWA,WAChC7G,iBAAiB,UAGV,aAAflC,EAAOC,OAEToL,EADQxL,SAAS4E,cAAcsE,WACrB7G,iBAAiB,0BAOzBlC,GAJe,gBAAfA,EAAOC,OACToL,EAAQxL,SAASqC,iBAAiB,qCAGjB,kBAAflC,EAAOC,MAA2C,WAAfD,EAAOC,KAAmB,CAK7DJ,GAHFwL,EADQxL,SAAS4E,cAAcsE,WACrB7G,iBAAiB,SAGzBrC,SAAS4E,cAAcsE,WAAW3E,UAAUkD,SAAS,gBAG9C,OADPzH,SAAS4E,cAAcsE,WAAW5G,SAC3B,EAEPtC,SAASC,eAAe,kBAAkBwL,kBAAkBnJ,QAG5DoJ,IAAAA,EAAgB,EAEhB7G,GAAQ2G,EAAMrJ,SAChBuJ,EAAgBF,EAAM3G,IACRvC,QAGZuC,GAAQ2G,EAAMrJ,SAChBuJ,EAAgBF,EAAM,IACRlJ,QAGVsG,IAAAA,EAAO5I,SAAS4E,cAAciE,wBAC9BC,EACJF,EAAKG,IAAM/I,SAASgJ,KAAKH,wBAAwBE,IAAMH,EAAKK,OAAS,EAQnE9I,OANJH,SAAS4E,cAAcsE,WAAWC,SAAS,CACzCC,KAAM,EACNL,IAAKD,EAAMO,OAAOC,YAAc,EAChCC,SAAU,WAGO,SAAfpJ,EAAOC,MAAkC,aAAfD,EAAOC,MAC/BsL,EAAcnD,aAAa,eAC7BpI,EAAOE,aAAeqL,EAAc3H,aAAa,aACjD5D,EAAOwL,gBAAkBD,EAAc3H,aAAa,WACpDL,EAAgBvD,EAAOE,gBAElB,GAIsB,sBAA7BL,SAAS4E,cAAcgH,IACR,kBAAfzL,EAAOC,MAEPoF,OAAOC,WAAW,GAAI,eAAgB,KAC/B,GAIsB,sBAA7BzF,SAAS4E,cAAcgH,IACR,kBAAfzL,EAAOC,MAEPoF,OAAOC,WAAW,GAAI,OAAQ,KACvB,QAJPzF,GAWJA,SACGC,eAAe,2BACf4L,iBAAiB,SAAU,SAACnJ,GAC3B0F,WAAW,WACTpI,SACGC,eAAe,2BACf6L,cAAcxJ,SAChB,OAIP9B,EAASiI,qBAAuB,OAEhCzI,SACGC,eAAe,6BACf4L,iBAAiB,SAAU,SAACnJ,GACvBqJ,IAAAA,EAAI/L,SAASC,eAAe,6BAA6B8H,MAC7DvH,EAASiI,qBAAuBsD,EAEhCxB,YACGC,QAAQ,WAAYhK,GACpBiK,KAAK,SAAU1C,MACf2C,MAAM,SAAUC,GACfjJ,QAAQC,IAAIgJ,KAGhBvC,WAAW,WACTpI,SACGC,eAAe,6BACf6L,cAAcxJ,SAChB,OAGPtC,SAASqC,iBAAiB,sBAAsBiC,QAAQ,SAAUR,GAChEA,EAAK+H,iBAAiB,SAAU,SAACnJ,GAC/B0F,WAAW,WACTtE,EAAKgI,cAAcxJ,SAClB,SAIPtC,SAASqC,iBAAiB,sBAAsBiC,QAAQ,SAAUR,GAChEA,EAAK+H,iBAAiB,SAAU,SAACnJ,GAC/B0F,WAAW,WACTtE,EAAKgI,cAAcxJ,SAClB,SAIP,IAAI0J,EAAY,SAAUxJ,EAAMyJ,EAAcL,GAGxC/K,GAAAA,UAAUqL,UAAW,CAEnB7E,IAAAA,EAAO,CACT8E,IAAKF,EACLG,SAAUR,GAKRS,EAAUxL,UAAUqL,UAAUzH,IAAIjC,EAAM,gBAAiB6E,GAE7DgF,EAAQrL,UAAY,aAIpBqL,EAAQnL,QAAU,WAChBQ,QAAQC,IAAI,sBAAwB,KAAK2K,MAAM1C,SAQjD2C,EAAe,SAAUX,GAKvB/K,GAAAA,UAAUqL,UAAW,CACnBG,IAAAA,EAAUxL,UAAUqL,UAAUM,SAElCH,EAAQrL,UAAY,WACbC,KAAAA,OAAOqD,QAAQ,SAAUmI,GACxBA,GAAAA,EAAMpF,KAAK+E,UAAYR,EAAI,CACzBc,IAAAA,EAAM7L,UAAUqL,UAAU1H,OAAOiI,EAAMb,IAE3Cc,EAAI1L,UAAY,WACdU,QAAQC,IAAI,YAGd+K,EAAIxL,QAAU,WACZQ,QAAQC,IAAI,sBAAwB,KAAK2K,MAAM1C,YAGjDlI,QAAQC,IAAI,uBAKlB0K,EAAQnL,QAAU,WAChBQ,QAAQC,IAAI,qBAAsB,KAAK2K,MAAM1C,SAK/C+C,EAAa,WACX9L,GAAAA,UAAUqL,UAAW,CACnBG,IAAAA,EAAUxL,UAAUqL,UAAUM,SAElCH,EAAQrL,UAAY,WACbC,KAAAA,OAAOqD,QAAQ,SAAUmI,GAC5B/K,QAAQC,IAAI,MAAO8K,EAAMb,IACzBlK,QAAQC,IAAI,QAAS8K,EAAMjK,MAC3Bd,QAAQC,IAAI,mBAAoB8K,EAAMG,iBACtClL,QAAQC,IAAI,QAASkL,KAAKC,UAAUL,EAAMpF,UAI9CgF,EAAQnL,QAAU,WAChBQ,QAAQC,IAAI,qBAAsB,KAAK2K,MAAM1C,SAc/CmD,EAAmB,SAAUzL,GAC3B0L,IAAAA,EAAK1L,EAAE2L,QAAQ,KAAM,IAIlBD,OAFPA,GADAA,EAAKA,EAAGC,QAAQ,KAAM,KACdA,QAAQ,IAAK,KACrBD,GAAU,MAIRE,EAAc,GAEdC,EAAc,WACZC,IAAAA,EAAa,WACwC,IAArDpN,SAASC,eAAe,oBAAoB8H,QAC9CqF,EAAapN,SAASC,eAAe,oBAAoB8H,OAGvDsF,IAAAA,EAAW,WACwC,IAAnDrN,SAASC,eAAe,kBAAkB8H,QAC5CsF,EAAWrN,SAASC,eAAe,kBAAkB8H,OAGnDuF,IAAAA,EACFtN,SAASC,eAAe,cAAc8H,MAAQ,IAAMqF,EAEC,IAAnDpN,SAASC,eAAe,kBAAkB8H,QAC5C/H,SAASC,eAAe,kBAAkB8H,MACxC/H,SAASC,eAAe,cAAc8H,OAEtCwF,IAQAC,EARAD,EACFvN,SAASC,eAAe,kBAAkB8H,MAAQ,IAAMsF,EAGtDI,EAAoBzN,SAASC,eAC/B,2BACA8H,MAGuB,QAArB0F,KACFD,EAAoB,IAAIhO,KAAK8N,IACXI,WAChBF,EAAkBG,aAAeF,GAGnCA,EAAoBV,EAAiBS,EAAkB9G,gBAGrD9D,IAAAA,GAAgB,EAEZ,IAAIpD,KAAKQ,SAASC,eAAe,cAAc8H,OAAO9F,WACtD,IAAIzC,KAAKQ,SAASC,eAAe,kBAAkB8H,OAAO9F,YAGhEW,GAAgB,GAGdgL,IAEEC,EADAxJ,EAYF3B,EAAQ,CACVoL,IAAKtI,OAAOuI,MACZC,QAAShO,SAASC,eAAe,eAAe8H,MAChDkG,SAAUjO,SAASC,eAAe,kBAAkB8H,MACpDmG,YAAalO,SAASC,eAAe,qBAAqB8H,MAC1DoG,MAAO,UACPC,QAASrB,EAAiBO,GAC1Be,QAAStB,EAAiBO,GAC1BgB,MAAOvB,EAAiBQ,GACxBgB,OArBIlK,EAAIrE,SAASC,eAAe,eAAe8H,MAEtC,IAAL1D,GAAgB,QAALA,IACbwJ,EACE,QACA7N,SAASC,eAAe,eAAe8H,MACvC,UACAgF,EAAiBQ,IAEdM,GAaPzK,OAAQpD,SAASC,eAAe,eAAe8H,MAC/C3F,UAAWpC,SAASC,eAAe,cAAc8H,MACjDhF,QAAS/C,SAASC,eAAe,kBAAkB8H,MACnDyG,WAAYxO,SAASC,eAAe,oBAAoB8H,MACxD0G,SAAUzO,SAASC,eAAe,kBAAkB8H,MACpD0E,MAAOzM,SAASC,eAAe,2BAA2B8H,MAC1D2G,aAAcjB,EACdxK,gBAAgB,EAChBL,cAAeA,EACf+L,OAAQlO,GAGS,QAAfiC,EAAM+J,QACR/J,EAAMkM,MAAQ,SACdlM,EAAM,2BAA6B+K,EACnC/K,EAAMmM,OAAS,QACfnM,EAAMoM,IAAM,SACZ9C,EAAUwB,EAAmB9K,EAAMsL,QAAStL,EAAMoL,MAGpDpN,EAAOuD,KAAKvB,GAERqM,IAAAA,EAAuBrO,EAAOoK,OAChC,SAACpK,GAAWA,OAA0B,IAA1BA,EAAOuC,iBAGrBsH,YACGC,QAAQ,SAAUuE,GAClBtE,KAAK,SAAU1C,GACdvC,OAAO0E,QAAQ,QAAS,KAGxBvC,IACAb,EAAYpG,GAEZ8I,SAASwF,YAAY,WAAYD,KAElCrE,MAAM,SAAUC,MAEnBxK,EAAOC,KAAO,QACdkI,KAOE2G,EAAe,WACjBvO,EAAO4D,QAAQ,SAAUgD,GACnBlG,IA6CIyM,EADAxJ,EAvCJzB,GAAgB,EAMhB0E,GAXI,IAAI9H,KAAKQ,SAASC,eAAe,cAAc8H,OAAO9F,WACtD,IAAIzC,KACVQ,SAASC,eAAe,kBAAkB8H,OAC1C9F,YAKAW,GAAgB,GAGd0E,EAAMwG,KAAO3N,EAAOwL,gBAAiB,CACnCyB,IAAAA,EAAa,WACwC,IAArDpN,SAASC,eAAe,oBAAoB8H,QAC9CqF,EAAapN,SAASC,eAAe,oBAAoB8H,OAGvDsF,IAAAA,EAAW,WACwC,IAAnDrN,SAASC,eAAe,kBAAkB8H,QAC5CsF,EAAWrN,SAASC,eAAe,kBAAkB8H,OAGnDuF,IAAAA,EACFtN,SAASC,eAAe,cAAc8H,MAAQ,IAAMqF,EAElDG,EACFvN,SAASC,eAAe,cAAc8H,MAAQ,IAAMsF,EAGlDI,EAAoBzN,SAASC,eAC/B,2BACA8H,MAEEyF,EAAoB,GACC,QAArBC,KACFD,EAAoB,IAAIhO,KAAK8N,IACXI,WAChBF,EAAkBG,aAAeF,GAGnCA,EAAoBV,EAAiBS,EAAkB9G,gBAgBzDY,EAAM0G,QAAUhO,SAASC,eAAe,eAAe8H,MACvDT,EAAM4G,YAAclO,SAASC,eAAe,qBAAqB8H,MACjET,EAAM2G,SAAWjO,SAASC,eAAe,kBAAkB8H,MAC3DT,EAAM+G,QAAUtB,EAAiBO,GACjChG,EAAMgH,MAAQvB,EAAiBQ,GAC/BjG,EAAMvE,QAAU/C,SAASC,eAAe,kBAAkB8H,MAC1DT,EAAMlF,UAAYpC,SAASC,eAAe,cAAc8H,MACxDT,EAAMkH,WAAaxO,SAASC,eAAe,oBAAoB8H,MAC/DT,EAAMmH,SAAWzO,SAASC,eAAe,kBAAkB8H,MAC3DT,EAAMiH,OAnBK,KAFLlK,EAAIrE,SAASC,eAAe,eAAe8H,QAE3B,QAAL1D,IACbwJ,EACE,QACA7N,SAASC,eAAe,eAAe8H,MACvC,UACAgF,EAAiBQ,IAEdM,GAaTvG,EAAMlE,OAASpD,SAASC,eAAe,eAAe8H,MACtDT,EAAMrE,gBAAiB,EACvBqE,EAAM1E,cAAgBA,EACtB0E,EAAMmF,MAAQzM,SAASC,eAAe,2BAA2B8H,MACjET,EAAMoH,aAAejB,EACT,IAARhN,IAAY6G,EAAMqH,OAASlO,GAEZ,QAAf6G,EAAMmF,QACRF,EAAajF,EAAMwG,KACnBxG,EAAMsH,MAAQ,SACdtH,EAAM,4BAA8BmG,EACpCnG,EAAMuH,OAAS,QACfvH,EAAMwH,IAAM,SACZ9C,EAAUwB,EAAmBlG,EAAM0G,QAAS1G,EAAMwG,SAKpDiB,IAAAA,EAAuBrO,EAAOoK,OAChC,SAACpK,GAAWA,OAA0B,IAA1BA,EAAOuC,iBAGrBsH,YACGC,QAAQ,SAAUuE,GAClBtE,KAAK,SAAU1C,GAEdjB,EAAYpG,GAEZ8I,SAASwF,YAAY,WAAYjH,GACjC5H,EAAOC,KAAO,QACdkI,IACAX,MAED+C,MAAM,SAAUC,OASjBnC,EAAa,WACfxI,SAASC,eAAe,gBAAgB2B,MAAMC,QAAU,QACxD7B,SAASC,eAAe,gBAAgB2B,MAAMC,QAAU,QAExDnB,EAAO4D,QAAQ,SAAUgD,GACnBA,EAAMwG,KAAO3N,EAAOwL,kBACtB3L,SAASC,eAAe,eAAe8H,MAAQT,EAAM0G,QACrDhO,SAASC,eAAe,cAAc8H,MAAQT,EAAMlF,UACpDpC,SAASC,eAAe,kBAAkB8H,MAAQT,EAAMvE,QACxD/C,SAASC,eAAe,oBAAoB8H,MAAQT,EAAMkH,WAC1DxO,SAASC,eAAe,kBAAkB8H,MAAQT,EAAMmH,SACxDzO,SAASC,eAAe,qBAAqB8H,MAAQT,EAAM4G,YAC3DlO,SAASC,eAAe,kBAAkB8H,MAAQT,EAAM2G,SACxDjO,SAASwB,cAAc,4BAA4BuG,MAAQT,EAAMmF,MACjEzM,SAASC,eAAe,cAAcwB,IAAM6F,EAAMqH,OAClD3O,SAASC,eAAe,eAAe8H,MAAQT,EAAMlE,WASvD8L,GAAe,WAGjBxO,EAASA,EAAOoK,OAAO,SAACqE,GAAWA,OAAAA,EAAOrB,KAAO3N,EAAOwL,kBACxDY,EAAapM,EAAOwL,iBAGpBxL,EAAOqI,YAAa,EAChBuG,IAAAA,EAAuBrO,EAAOoK,OAChC,SAACpK,GAAWA,OAA0B,IAA1BA,EAAOuC,iBAiBdmM,OAdPzH,IAEA4C,YACGC,QAAQ,SAAUuE,GAClBtE,KAAK,SAAU1C,GACdjB,EAAYpG,GAEZ8I,SAASwF,YAAY,WAAYjH,KAElC2C,MAAM,SAAUC,GAEfjJ,QAAQC,IAAIgJ,MAlBZ,GAyBFrJ,GAAI,IAAI9B,KACRgI,GAAI,IAAIlG,OAAAA,GAAE5B,WAAa,GAAI8G,OAAO,GAClCxC,GAAI,IAAI1C,OAAAA,GAAExB,WAAY0G,OAAO,GAC7B6I,GAAI/N,GAAE1B,cACV8D,EAAgB2L,GAAI,IAAM7H,GAAI,IAAMxD,IAGpC,IA4DIsL,GA5DAC,GAAe,SAAU3D,EAAIpJ,GAC/BgD,OAAO0E,QAAQ,OAAQ,KACvB1E,OAAOC,WAAW,OAAQ,GAAI,IAG1BsJ,IAAAA,EAAuBrO,EAAOoK,OAChC,SAACpK,GAAWA,OAA0B,IAA1BA,EAAOuC,iBAGrBsH,YACGC,QAAQ,SAAUuE,GAClBtE,KAAK,SAAU1C,GACdjB,EAAYpG,GAEZ8I,SAASwF,YAAY,WAAYD,KAElCrE,MAAM,SAAUC,OAGjB6E,GAAoB,WAClBxL,IAAAA,EAAI,IAAIxE,KAGR6E,EAFM,IAAIL,OAAAA,EAAEyL,YAAajJ,OAAO,GAEtB,IADJ,IAAIxC,OAAAA,EAAE2J,cAAenH,OAAO,GAGlCkJ,EAAO,IAAI1L,OAAAA,EAAEyL,WAAa,GAAIjJ,OAAO,GAErCkJ,EAAO,KAAIA,EAAO,MAElBnM,IAAAA,EAAKmM,EAAO,IAHL,IAAI1L,OAAAA,EAAE2J,cAAenH,OAAO,GAKvCxG,SAASC,eAAe,oBAAoB8H,MAAQ1D,EACpDrE,SAASC,eAAe,kBAAkB8H,MAAQxE,GAGhDoM,GAAsB,SAAUC,GAC1B5P,SAASC,eAAe,cAE9BwB,IAAMoO,IAAIC,gBAAgBF,GAC5B5P,SAASC,eAAe,sBAAsBsE,UAAUE,IAAI,QAE5DzE,SACGqC,iBAAiB,4BACjBiC,QAAQ,SAAUpC,EAAGmC,GACpBnC,EAAEoE,aAAa,WAAYjC,KAG3B0L,IAAAA,EAAK,IAAIC,WACbD,EAAGE,OAAS,WACVxP,EAAOsP,EAAG9O,QAEZ8O,EAAGG,cAAcN,IAOfO,IAAY,EACVC,GAAqB,IAG3B,SAASC,GAAcC,GACbA,EAAMC,IAYhB,SAASC,GAAiBF,GAChBA,OAAAA,EAAMC,KACP,IAAA,IACH,MAEG,IAAA,YACHlH,OAAOoH,QACP,MAEG,IAAA,YACCtQ,EAAOC,MAWjB,SAASsQ,GAAkBJ,GACjBA,OAAAA,EAAMC,KACP,IAAA,IACH7L,IAEA,MAEG,IAAA,UACgB,SAAfvE,EAAOC,MACT8K,GAAK,GAGU,kBAAf/K,EAAOC,MACQ,aAAfD,EAAOC,MACQ,WAAfD,EAAOC,MACQ,gBAAfD,EAAOC,MAEP8K,GAAK,GAEP,MACG,IAAA,YACgB,SAAf/K,EAAOC,MACT8K,EAAI,GAGW,kBAAf/K,EAAOC,MACQ,aAAfD,EAAOC,MACQ,WAAfD,EAAOC,MACQ,gBAAfD,EAAOC,MAEP8K,EAAI,GAGN,MACG,IAAA,aACC/K,GAAe,SAAfA,EAAOC,KAAiB,OAAO,EAEnC8K,EAAI,GACJ,MACG,IAAA,YACC/K,GAAe,SAAfA,EAAOC,KAAiB,OAAO,EAEnC8K,GAAK,GAEL,MAEG,IAAA,IACHpG,IACA,MACG,IAAA,IACHD,IACA,MAEG,IAAA,IACHT,IACA,MAEG,IAAA,IACHpE,SACGqC,iBACC,iEAEDiC,QAAQ,SAAUwD,GACjBA,EAAEvD,UAAUoM,OAAO,YAEvB,MAEG,IAAA,IACH,MAEG,IAAA,YACA,IAAA,MAECxQ,GADJuB,QAAQC,IAAIxB,EAAOC,MACA,SAAfD,EAAOC,KAIF,OAHPD,EAAOC,KAAO,UACdkI,KAEO,EAGLnI,GAAe,gBAAfA,EAAOC,KAGF,OADPgK,KACO,EAET,MAEG,IAAA,WACA,IAAA,UACCjK,GAAe,aAAfA,EAAOC,KAAqB,CAC1BJ,GAAAA,SAAS4E,cAAcL,UAAUkD,SAAS,gBAErC,OADPjC,OAAO0E,QAAQ,kCAAmC,MAC3C,EAGT/J,EAAOwL,gBACL3L,SAAS4E,cAAcb,aAAa,WAEtC5D,EAAOqI,YAAa,EAEpBA,IACArI,EAAOC,KAAO,iBACdkI,IAEEnI,GAAe,gBAAfA,EAAOC,KAEF,OADPwQ,GAAGC,WAAW1G,IACP,EAGLhK,GAAe,WAAfA,EAAOC,KAEF,OADPwK,KACO,EAGLzK,GAAe,SAAfA,EAAOC,KASF,OARPD,EAAOC,KAAO,iBACdkI,IAKAkH,MAEO,EAET,MAEG,IAAA,QACC,IAACrP,EAAOG,QAAS,OAAO,EAExBN,GAAAA,SAAS4E,cAAcL,UAAUkD,SAAS,gBAErC,OADPzH,SAAS4E,cAAckM,SAAS,GAAGxO,SAC5B,EAGLtC,GAA6B,gBAA7BA,SAAS4E,cAAcgH,GAUlB,OATPlL,EAAO4D,QAAQ,SAAUgD,GACnBA,EAAMwG,KAAO3N,EAAOwL,iBACtBuB,EAAYjJ,KAAKqD,KAIrBkC,SAASwF,YAAY9B,EAAY,GAAGY,IAAM,OAAQZ,GAClD1H,OAAO0E,QAAQ,iBAAkB,MAE1B,EAGLlK,GAA6B,gBAA7BA,SAAS4E,cAAcgH,GAElB,OADPpG,OAAOuL,WAAWpB,KACX,EAGL3P,GAA6B,sBAA7BA,SAAS4E,cAAcgH,GAGlB,OAFP5L,SAASC,eAAe,cAAcwB,IAAM,GAC5ChB,EAAO,IACA,EAIPT,GACA,oBADAA,SAAS4E,cAAcb,aAAa,iBAK7B,OAFP5D,EAAOC,KAAO,eACdkI,KACO,EAILtI,GAA6B,cAA7BA,SAAS4E,cAAcgH,GAOlB,OANHzL,EAAOqI,WACTyG,IAEA9B,KAGK,EAGLnN,GAA6B,gBAA7BA,SAAS4E,cAAcgH,GAKlB,OAJHsD,OACF/O,EAAOC,KAAO,QACdkI,MAEK,EAGLnI,GAAe,WAAfA,EAAOC,KAsBF,MApBmD,UAAxDJ,SAAS4E,cAAcb,aAAa,kBAEpCwG,YACGU,QAAQ,UACRR,KAAK,SAAU1C,GACdyB,SAASwF,YAAY,WAAYjH,KAElC2C,MAAM,SAAUC,GACfjJ,QAAQC,IAAIgJ,KAKwC,UAAxD3K,SAAS4E,cAAcb,aAAa,kBAEpCyF,SAASwH,QACPhR,SAAS4E,cAAcb,aAAa,iBACpCwL,KAGG,EAEU,SAAfpP,EAAOC,MAAkC,aAAfD,EAAOC,MACnCkI,EAAO,QAET,MAEG,IAAA,YAEc,kBAAfnI,EAAOC,MAC2B,SAAlCJ,SAAS4E,cAAcqM,UAEvB9Q,EAAOC,KAAO,QACdkI,KAGiB,WAAfnI,EAAOC,OACTD,EAAOC,KAAO,QACdkI,KAGiB,QAAfnI,EAAOC,OACTD,EAAO+Q,MAAQ,eACf5I,MAWR,SAAS6I,GAAcC,GACrBjJ,IACgB,cAAZiJ,EAAIb,MAEW,WAAfpQ,EAAOC,MACQ,kBAAfD,EAAOC,MACQ,QAAfD,EAAOC,MAEPgR,EAAIC,kBAIQ,YAAZD,EAAIb,MACNa,EAAIC,iBACJhI,OAAOoH,SAEJW,EAAIE,SACPnB,IAAY,EACZb,GAAUlH,WAAW,WACnB+H,IAAY,EACZK,GAAiBY,IAChBhB,KAGDgB,EAAIE,SACS,aAAXF,EAAIb,MAAoBJ,IAAY,GAExCE,GAAce,IAIlB,SAASG,GAAYH,GACfjR,IAAmB,IAAnBA,EAAOG,QAAmB,OAAO,EAEtB,aAAX8Q,EAAIb,KAAsBvQ,SAAS4E,cAAcqM,QAGrDO,aAAalC,IACRa,IACHO,GAAkBU,GAItBpR,SAAS6L,iBAAiB,UAAWsF,IACrCnR,SAAS6L,iBAAiB,QAAS0F,IAEnCvR,SAAS6L,iBAAiB,mBAAoBd,GAAwB,GAGxElK,UAAU4Q,cACPC,SAAS,wCACTjH,KAAK,SAACkH,GAELjQ,QAAQC,IAAI,oCAAsCgQ,EAAIC,SAEvDlH,MAAM,SAAC4B,GAEN5K,QAAQC,IAAI,4BAA8B2K","file":"application.73831ff2.js","sourceRoot":"../application","sourcesContent":["\"use strict\";\n\n  let months = [\n    \"Jan\",\n    \"Feb\",\n    \"Mar\",\n    \"Apr\",\n    \"May\",\n    \"Jun\",\n    \"Jul\",\n    \"Aug\",\n    \"Sep\",\n    \"Oct\",\n    \"Nov\",\n    \"Dec\",\n  ];\n\n  let weekday = [\"Sun\", \"Mon\", \"Tue\", \"Wed\", \"Thu\", \"Fri\", \"Sat\"];\n\n  let today = new Date();\n  let currentMonth = today.getMonth();\n  let currentYear = today.getFullYear();\n  let currentDay = today.getDate();\n  let monthAndYear = document.getElementById(\"monthAndYear\");\n\n  let once = false;\n\n  let status = {\n    view: \"month\",\n    selected_day: \"\",\n    visible: false,\n    update_event_id: \"\",\n  };\n\n  let settings = {};\n\n  let blob = \"\";\n  let events = [];\n\n  //ads || ads free\n\n  //KaioOs ads\n  let getManifest = function (callback) {\n    if (!navigator.mozApps) {\n      return false;\n    }\n    let self = navigator.mozApps.getSelf();\n    self.onsuccess = function () {\n      callback(self.result);\n    };\n    self.onerror = function () {};\n  };\n\n  let self;\n  //KaiOs store true||false\n  function manifest(a) {\n    self = a.origin;\n    let t = document.getElementById(\"KaiOsAds-Wrapper\");\n    if (a.installOrigin == \"app://kaios-plus.kaiostech.com\") {\n      document.querySelector(\"#KaiOsAds-Wrapper iframe\").src = \"ads.html\";\n    } else {\n      console.log(\"Ads free\");\n      t.style.display = \"none\";\n    }\n  }\n\n  getManifest(manifest);\n\n  // ////////\n  // finde closest event to selected date in list view\n  // ////////\n\n  let find_closest_date = function (search_term) {\n    let t = 0;\n    let search = new Date(search_term).getTime();\n\n    for (let i = 0; i < events.length; i++) {\n      let item = new Date(events[i].dateStart).getTime();\n\n      if (search < item) {\n        t = events[i - 1].dateStart;\n        i = events.length;\n      }\n      //after last event\n      //focus last event\n      if (search > new Date(events[events.length - 1].dateStart).getTime()) {\n        t = events[events.length - 1].dateStart;\n        i = events.length;\n      }\n    }\n    document\n      .querySelectorAll(\"div#list-view article[data-date='\" + t + \"']\")[0]\n      .focus();\n    return t;\n  };\n\n  // check if has event\n  let event_check = function (date) {\n    let feedback = {\n      date: \"\",\n      event: false,\n      subscription: false,\n      multidayevent: false,\n      rrule: \"none\",\n    };\n\n    for (let t = 0; t < events.length; t++) {\n      if (typeof events[t] === \"object\") {\n        feedback.event = false;\n        feedback.subscription = false;\n        feedback.multidayevent = false;\n        feedback.rrule = false;\n        feedback.date = date;\n\n        let a = new Date(events[t].dateStart).getTime();\n        let b = new Date(events[t].dateEnd).getTime();\n        let c = new Date(date).getTime();\n\n        // multi day event\n        if (events[t][\"rrule_\"] == \"none\") {\n          if (a === c || b === c || (a < c && b > c)) {\n            feedback.event = true;\n            if (events[t].isSubscription === true) {\n              feedback.subscription = true;\n            }\n\n            if (events[t].multidayevent === true) {\n              feedback.multidayevent = true;\n            }\n            t = events.length;\n          }\n        }\n      }\n    }\n    return feedback;\n  };\n\n  // check if has event\n  let rrule_check = function (date) {\n    let feedback = {\n      date: \"\",\n      event: false,\n      subscription: false,\n      multidayevent: false,\n      rrule: \"none\",\n    };\n\n    for (let t = 0; t < events.length; t++) {\n      if (typeof events[t] === \"object\") {\n        feedback.event = false;\n        feedback.subscription = false;\n        feedback.multidayevent = false;\n        feedback.rrule = false;\n        feedback.date = date;\n\n        let a = new Date(events[t].dateStart).getTime();\n        let b = new Date(events[t].dateEnd).getTime();\n        let c = new Date(date).getTime();\n\n        //recurrences\n\n        if (\n          typeof events[t][\"rrule_\"] !== \"undefined\" &&\n          events[t][\"rrule_\"] !== undefined\n        ) {\n          if (\n            new Date(events[t].dateStart).getTime() <=\n              new Date(date).getTime() &&\n            new Date(date).getTime() <= new Date(events[t].dateEnd).getTime()\n          ) {\n            if (events[t].rrule_ == \"MONTHLY\") {\n              if (\n                new Date(events[t].dateStart).getDate() ===\n                new Date(date).getDate()\n              ) {\n                feedback.rrule = true;\n                t = events.length;\n                return feedback;\n              }\n            }\n\n            if (events[t][\"rrule_\"] == \"DAILY\") {\n              feedback.rrule = true;\n              t = events.length;\n              return feedback;\n            }\n\n            if (events[t].rrule_ == \"WEEKLY\") {\n              if (\n                new Date(events[t].dateStart).getDay() ===\n                new Date(date).getDay()\n              ) {\n                feedback.rrule = true;\n                t = events.length;\n                return feedback;\n              }\n            }\n\n            if (events[t].rrule_ == \"YEARLY\") {\n              let tt = new Date(events[t].dateStart);\n              let pp = new Date(date);\n\n              if (\n                tt.getDate() + \"-\" + tt.getMonth() ===\n                pp.getDate() + \"-\" + pp.getMonth()\n              ) {\n                feedback.rrule = true;\n                t = events.length;\n                return feedback;\n              }\n            }\n          }\n        }\n      }\n    }\n    return feedback;\n  };\n\n  //////////////////\n  //event slider\n  ///////////\n\n  let slider = [];\n  let slider_index = 0;\n\n  let event_check_day = function (date) {\n    slider = [];\n    let k = document.querySelector(\"div#event-slider-indicator div\");\n    k.innerHTML = \"\";\n\n    var elements = document.querySelectorAll(\"div#event-slider article\");\n    for (var i = 0; i < elements.length; i++) {\n      elements[i].style.display = \"none\";\n    }\n\n    let item = document.querySelectorAll(\"div#event-slider article\");\n\n    for (let i = 0; i < item.length; i++) {\n      let a = new Date(item[i].getAttribute(\"data-date\")).getTime();\n      let b = new Date(item[i].getAttribute(\"data-date-end\")).getTime();\n      let c = new Date(date).getTime();\n      let d = item[i].getAttribute(\"data-rrule\");\n\n      if (d === \"none\" || d === \"\") {\n        if (a === c || b === c || (a < c && b > c)) {\n          slider.push(item[i]);\n          slider[0].style.display = \"block\";\n\n          k.insertAdjacentHTML(\"beforeend\", \"<div class='indicator'></div>\");\n        }\n      } else {\n        if (a === c || b === c || (a < c && b > c && d)) {\n          //recurrences\n          //YEAR\n          if (d == \"YEARLY\") {\n            let tt = new Date(item[i].getAttribute(\"data-date\"));\n            let pp = new Date(date);\n\n            if (\n              tt.getDate() + \"-\" + tt.getMonth() ===\n              pp.getDate() + \"-\" + pp.getMonth()\n            ) {\n              slider.push(item[i]);\n              slider[0].style.display = \"block\";\n\n              k.insertAdjacentHTML(\n                \"beforeend\",\n                \"<div class='indicator'></div>\"\n              );\n            }\n          }\n\n          //WEEK\n          if (d == \"WEEKLY\") {\n            if (\n              new Date(item[i].getAttribute(\"data-date\")).getDay() ==\n              new Date(date).getDay()\n            ) {\n              slider.push(item[i]);\n              slider[0].style.display = \"block\";\n\n              k.insertAdjacentHTML(\n                \"beforeend\",\n                \"<div class='indicator'></div>\"\n              );\n            }\n          }\n\n          //MONTH\n\n          if (d == \"MONTHLY\") {\n            if (\n              new Date(item[i].getAttribute(\"data-date\")).getDate() ==\n              new Date(date).getDate()\n            ) {\n              slider.push(item[i]);\n              slider[0].style.display = \"block\";\n\n              k.insertAdjacentHTML(\n                \"beforeend\",\n                \"<div class='indicator'></div>\"\n              );\n            }\n          }\n\n          if (d == \"DAILY\") {\n            if (a === c || b === c || (a < c && b > c)) {\n              slider.push(item[i]);\n              slider[0].style.display = \"block\";\n\n              k.insertAdjacentHTML(\n                \"beforeend\",\n                \"<div class='indicator'></div>\"\n              );\n            }\n          }\n        }\n      }\n    }\n    if (slider != \"\" && slider.length > 0) {\n      k.style.opacity = 100;\n    } else {\n      k.style.opacity = 0;\n    }\n  };\n\n  let slider_navigation = function () {\n    let p = document.querySelectorAll(\"div#event-slider-indicator div div\");\n    if (slider_index == slider.length - 1) {\n      slider_index = -1;\n    }\n    slider_index++;\n    slider.forEach(function (item) {\n      item.style.display = \"none\";\n    });\n    slider[slider_index].style.display = \"block\";\n    p.forEach(function (item) {\n      item.classList.remove(\"active\");\n    });\n    p[slider_index].classList.add(\"active\");\n  };\n\n\n\n  ////\n  // JUMP TO TODAY\n  ////\n\n  let jump_to_today = function () {\n    let currentMonth = today.getMonth();\n    let currentYear = today.getFullYear();\n    showCalendar(currentMonth, currentYear);\n    console.log(currentMonth);\n\n    event_check_day(status.selected_day);\n    status.selected_day = document.activeElement.getAttribute(\"data-date\");\n  };\n\n  function next() {\n    currentYear = currentMonth === 11 ? currentYear + 1 : currentYear;\n    currentMonth = (currentMonth + 1) % 12;\n    showCalendar(currentMonth, currentYear);\n    event_check_day(status.selected_day);\n  }\n\n  function previous() {\n    currentYear = currentMonth === 0 ? currentYear - 1 : currentYear;\n    currentMonth = currentMonth === 0 ? 11 : currentMonth - 1;\n    showCalendar(currentMonth, currentYear);\n    event_check_day(status.selected_day);\n  }\n\n  //////////////\n  //BUILD CALENDAR\n  //////////////\n\n  // get weeknumber\n  Date.prototype.getWeek = function () {\n    var date = new Date(this.getTime());\n    date.setHours(0, 0, 0, 0);\n\n    // Thursday in current week decides the year.\n    date.setDate(date.getDate() + 3 - ((date.getDay() + 6) % 7));\n\n    // January 4 is always in week 1.\n    var week1 = new Date(date.getFullYear(), 0, 4);\n\n    // Adjust to Thursday in week 1 and count number of weeks from date to week1.\n    return (\n      1 +\n      Math.round(\n        ((date.getTime() - week1.getTime()) / 86400000 -\n          3 +\n          ((week1.getDay() + 6) % 7)) /\n          7\n      )\n    );\n  };\n\n  let showCalendar = function (month, year) {\n    helper.bottom_bar(\"add\", \"events\", \"options\");\n\n    let firstDay = new Date(year, month).getDay();\n    let daysInMonth = 32 - new Date(year, month, 32).getDate();\n\n    let tbl = document.getElementById(\"calendar-body\");\n\n    // clearing all previous cells\n    tbl.innerHTML = \"\";\n\n    // filing data about month and in the page via DOM.\n    monthAndYear.innerHTML = months[month] + \" \" + year;\n\n    // creating all cells\n    let date = 1;\n    for (let i = 0; i < 6; i++) {\n      // creates a table row\n      let row = document.createElement(\"div\");\n      row.classList.add(\"flex\");\n      row.classList.add(\"row\");\n      row.classList.add(\"width-100\");\n\n      // creating individual cells, filing them up with data.\n      for (let j = 0; j < 7; j++) {\n        if (i === 0 && j < firstDay) {\n          let cell = document.createElement(\"div\");\n          let cellText = document.createTextNode(\"\");\n          cell.appendChild(cellText);\n          row.appendChild(cell);\n        } else if (date > daysInMonth) {\n          break;\n        } else {\n          let cell = document.createElement(\"div\");\n          let span = document.createElement(\"span\");\n          let moon = document.createElement(\"div\");\n\n          let cellText = document.createTextNode(date);\n          cell.appendChild(cellText);\n          cell.appendChild(span);\n\n          // set tabindex\n          cell.setAttribute(\"tabindex\", date - 1);\n\n          // store date with leading 0\n          // because input type date\n          // accept only day month with leading zero\n          let mmonth = `0${month + 1}`.slice(-2);\n          let day = `0${date}`.slice(-2);\n\n          let p = year + \"-\" + mmonth + \"-\" + day;\n\n          moon.classList.add(\"moon-phase-\" + getMoonPhase(year, month, date));\n          cell.appendChild(moon);\n\n          cell.setAttribute(\"data-date\", p);\n\n          cell.setAttribute(\"data-index\", new Date(p).toISOString());\n\n          // check if has event\n          if (events.length > 0) {\n            if (event_check(p).event) {\n              cell.classList.add(\"event\");\n            }\n\n            if (rrule_check(p).rrule) {\n              cell.classList.add(\"event\");\n            }\n\n            // check if has event + subscription\n            if (event_check(p).subscription == true) {\n              cell.classList.add(\"subscription\");\n            }\n          }\n\n          cell.classList.add(\"item\");\n          row.appendChild(cell);\n\n          date++;\n        }\n      }\n\n      // add weeknumbers\n      let week = document.createElement(\"span\");\n      week.classList.add(\"weeknumber\");\n\n      let weekText = document.createTextNode(\n        new Date(year, month, date).getWeek()\n      );\n\n      week.appendChild(weekText);\n      row.appendChild(week);\n\n      //add row\n      tbl.appendChild(row);\n    }\n\n    document.querySelectorAll(\".item\")[0].focus();\n    status.selected_day = document.activeElement.getAttribute(\"data-date\");\n\n    // highlight current day\n    if (today.getMonth() == month && today.getFullYear() == year) {\n      document.querySelectorAll(\".item\")[currentDay - 1].focus();\n      document.querySelectorAll(\".item\")[currentDay - 1].classList.add(\"today\");\n    }\n  };\n\n  let set_tabindex = function () {\n    document.querySelectorAll(\"div#list-view article\").forEach(function (i, p) {\n      i.setAttribute(\"tabindex\", p);\n    });\n  };\n\n  //RENDER\n\n  function renderHello(arr) {\n    document.getElementById(\"event-slider\").style.opacity = 0;\n    helper.sort_array(arr, \"dateStart\", \"date\");\n\n    var template = document.getElementById(\"template\").innerHTML;\n    var rendered = Mustache.render(template, { data: arr });\n    document.getElementById(\"list-view\").innerHTML = rendered;\n    document.getElementById(\"event-slider\").innerHTML = rendered;\n    document.getElementById(\"event-slider\").style.opacity = 100;\n\n    set_tabindex();\n    //event_check_day(document.activeElement.getAttribute(\"data-date\"));\n\n    //format date\n    document.querySelectorAll(\"article\").forEach(function (index) {\n      let t = new Date(index.getAttribute(\"data-date\"));\n      let n = new Date(index.getAttribute(\"data-date-end\"));\n\n      let d =\n        weekday[t.getDay()] +\n        \", \" +\n        t.getFullYear() +\n        \" \" +\n        months[t.getMonth()] +\n        \" \" +\n        t.getDate();\n\n      let m =\n        weekday[n.getDay()] +\n        \", \" +\n        n.getFullYear() +\n        \" \" +\n        months[n.getMonth()] +\n        \" \" +\n        n.getDate();\n\n      // to do singel day event or not\n      if (index.classList.contains(\"multidayevent\")) {\n        index.querySelector(\"div.date\").innerText = d + \" - \" + m;\n      } else {\n        index.querySelector(\"div.date\").innerText = d;\n      }\n    });\n  }\n\n\n  let clear_form = function () {\n    Array.from(document.querySelectorAll(\"div#add-edit-event input\")).forEach(\n      function (e) {\n        e.value = \"\";\n        document.getElementById(\"form-image\").src = \"\";\n        blob = \"\";\n      }\n    );\n  };\n\n  /*\n ///////////////\n// ///////////////\n// /////////////////\n// /ROUTER\n// ///////////////\n// ///////////////\n// //////////////\n*/\n\n  const month = document.getElementById(\"calendar\");\n  const add_edit_event = document.getElementById(\"add-edit-event\");\n  const list_view = document.getElementById(\"list-view\");\n  const options = document.getElementById(\"options\");\n\n  let option_button_bar = function () {\n    setTimeout(function () {\n      if (status.view == \"options\") {\n        if (\n          document.activeElement.getAttribute(\"data-function\") == \"subscription\"\n        ) {\n          helper.bottom_bar(\"delete\", \"select\", \"\");\n          return true;\n        } else {\n          helper.bottom_bar(\"\", \"select\", \"\");\n          return true;\n        }\n      }\n    }, 500);\n  };\n\n  const pages = document.querySelectorAll(\".page\");\n\n  let router = function (view) {\n    Array.from(pages).forEach(function (index) {\n      index.style.display = \"none\";\n    });\n\n    if (view == \"view\") {\n      if (status.view == \"month\") {\n        status.view = \"list-view\";\n      } else {\n        status.view = \"month\";\n      }\n    }\n\n    // add event view\n    if (status.view == \"add-edit-event\") {\n      if (document.activeElement.hasAttribute(\"data-date\"))\n        status.selected_day = document.activeElement.getAttribute(\"data-date\");\n\n      document.getElementById(\"event-date\").value = status.selected_day;\n\n      add_edit_event.style.display = \"block\";\n      Array.from(document.querySelectorAll(\"div#add-edit-event .item\")).forEach(\n        function (i, p) {\n          i.setAttribute(\"tabindex\", p);\n        }\n      );\n      add_edit_event.querySelectorAll(\".item\")[0].focus();\n      helper.bottom_bar(\"\", \"edit\", \"\");\n\n      if (document.getElementById(\"event-date-end\").value == \"\") {\n        document.getElementById(\"event-date-end\").value =\n          document.getElementById(\"event-date\").value;\n      }\n\n      if (status.edit_event) {\n        document.getElementById(\"save-event\").innerText = \"update\";\n      }\n      console.log(status.edit_event);\n\n      if (!status.edit_event) {\n        document.getElementById(\"save-event\").innerText = \"save\";\n\n        document.getElementById(\"event-notification-time\").value =\n          settings.default_notification;\n      }\n      return true;\n    }\n\n    // month view\n    if (status.view == \"month\") {\n      if (document.activeElement.hasAttribute(\"data-date\"))\n        status.selected_day = document.activeElement.getAttribute(\"data-date\");\n\n      options.style.display = \"none\";\n      month.style.display = \"block\";\n      helper.bottom_bar(\"add\", \"events\", \"options\");\n      status.edit_event = false;\n\n      let t = new Date(status.selected_day);\n      currentMonth = t.getMonth();\n      currentYear = t.getFullYear();\n\n      let k = status.selected_day;\n      showCalendar(currentMonth, currentYear);\n\n      Array.from(\n        document.querySelectorAll(\"div#calendar-body div.item\")\n      ).forEach(function (item) {\n        if (item.getAttribute(\"data-date\") == k) {\n          item.focus();\n          event_check_day(k);\n        }\n      });\n\n      clear_form();\n    }\n\n    // list view\n    if (status.view == \"list-view\") {\n      if (document.activeElement.hasAttribute(\"data-date\"))\n        status.selected_day = document.activeElement.getAttribute(\"data-date\");\n\n      options.style.display = \"none\";\n      status.edit_event = false;\n      clear_form();\n\n      helper.bottom_bar(\"edit\", \"month\", \"options\");\n\n      list_view.style.display = \"block\";\n      setTimeout(function () {\n        let articles = document.querySelectorAll(\"div#list-view article\");\n\n        let success = false;\n        for (var k = 0; k < articles.length; k++) {\n          if (articles[k].getAttribute(\"data-date\") == status.selected_day) {\n            articles[k].focus();\n            k = articles.length;\n            success = true;\n          }\n        }\n        //\n        for (var k = 0; k < articles.length; k++) {\n          console.log(articles[k].getAttribute(\"data-alarm\"));\n          if (articles[k].getAttribute(\"data-alarm\") == \"none\")\n            articles[k].querySelector(\"img.bell\").style.display = \"none\";\n        }\n        if (!success) {\n          document.querySelectorAll(\"div#list-view article\")[0].focus();\n          find_closest_date(status.selected_day);\n        }\n        const rect = document.activeElement.getBoundingClientRect();\n        const elY =\n          rect.top -\n          document.body.getBoundingClientRect().top +\n          rect.height / 2;\n\n        document.activeElement.parentNode.scrollBy({\n          left: 0,\n          top: elY - window.innerHeight / 2,\n          behavior: \"smooth\",\n        });\n      }, 1000);\n    }\n    if (status.view == \"options\") {\n      if (document.activeElement.hasAttribute(\"data-date\"))\n        status.selected_day = document.activeElement.getAttribute(\"data-date\");\n\n      if (!once) {\n        eximport.list_ics();\n        list_subscriptions();\n        once = true;\n      }\n\n      document.getElementById(\"options\").style.display = \"block\";\n      document.querySelectorAll(\"div#options .item\")[0].focus();\n      document.getElementById(\"options\").style.opacity = \"1\";\n      document.getElementById(\"subscription-form\").style.display = \"none\";\n      setTimeout(function () {\n        Array.from(document.querySelectorAll(\"div#options .item\")).forEach(\n          function (i, p) {\n            i.setAttribute(\"tabindex\", p);\n          }\n        );\n      }, 2000);\n\n      option_button_bar();\n    }\n\n    if (status.view == \"subscription\") {\n      document.getElementById(\"options\").style.opacity = \"0.3\";\n      document.getElementById(\"subscription-form\").style.display = \"block\";\n\n      document\n        .querySelectorAll(\"div#subscription-form div.item input\")[0]\n        .focus();\n\n      helper.bottom_bar(\"QR\", \"\", \"save\");\n    }\n  };\n\n  let list_subscriptions = function () {\n    if (subscriptions == null) return false;\n\n    subscriptions.forEach(function (item) {\n      document\n        .querySelector(\"div#options div#subscription-text\")\n        .insertAdjacentHTML(\n          \"afterend\",\n          '<button class=\"item dynamic\" data-function=\"subscription\">' +\n            item.name +\n            \"</button>\"\n        );\n\n      Array.from(document.querySelectorAll(\"div#options button\")).forEach(\n        function (i, p) {\n          i.setAttribute(\"tabindex\", p);\n        }\n      );\n    });\n  };\n\n  let lp = 0;\n  let load_subscriptions = function () {\n    if (\n      subscriptions == null ||\n      subscriptions.lenght == -1 ||\n      subscriptions.lenght == \"undefined\"\n    )\n      return false;\n\n    if (lp < subscriptions.length) {\n      eximport.fetch_ics(subscriptions[lp].url, load_subscriptions);\n      lp++;\n      helper.toaster(\"subscriptions loaded\", 2000);\n    } else {\n    }\n    jump_to_today();\n\n    renderHello(events);\n\n    event_check_day(document.activeElement.getAttribute(\"data-date\"));\n    if (document.activeElement.hasAttribute(\"data-date\"))\n      status.selected_day = document.activeElement.getAttribute(\"data-date\");\n  };\n\n  let callback_scan = function (url) {\n    helper.bottom_bar(\"QR\", \"save\", \"cancel\");\n    document.querySelector(\"div#subscription-form input#cal-subs-url\").value =\n      url;\n  };\n  let subscriptions = new Array();\n  let store_subscription = function () {\n    console.log(subscriptions);\n\n    if (\n      helper.validate(document.getElementById(\"cal-subs-url\").value) &&\n      document.getElementById(\"cal-subs-name\").value != \"\"\n    ) {\n      subscriptions = [];\n      subscriptions.push({\n        url: document.getElementById(\"cal-subs-url\").value,\n        name: document.getElementById(\"cal-subs-name\").value,\n      });\n\n      document.querySelector(\"input#cal-subs-name\").val = \"\";\n      document.querySelector(\"input#cal-subs-url\").val = \"\";\n\n      localforage\n        .setItem(\"subscriptions\", subscriptions)\n        .then(function (value) {\n          document.getElementById(\"subscription-form\").style.display = \"none\";\n          helper.toaster(\"subscription stored\", 2000);\n          status.view = \"options\";\n          router();\n        })\n        .catch(function (err) {\n          // This code runs if there were any errors\n          console.log(err);\n        });\n      load_subscriptions();\n      list_subscriptions();\n    } else {\n      helper.toaster(\"Please enter a name and a valid url\", 2000);\n    }\n  };\n\n  let delete_subscription = function () {\n    let updated_subscriptions = subscriptions.filter(\n      (e) => e.name != document.activeElement.innerText\n    );\n\n    localforage\n      .setItem(\"subscriptions\", updated_subscriptions)\n      .then(function (value) {\n        //Do other things once the value has been saved.\n        console.log(\"saved: \" + value);\n        helper.toaster(\"subscription deleted\", 2000);\n        status.view = \"month\";\n        router();\n      })\n      .catch(function (err) {\n        // This code runs if there were any errors\n        helper.toaster(err, 2000);\n      });\n\n    document.activeElement.remove();\n  };\n\n  localforage\n    .getItem(\"events\")\n    .then(function (value) {\n      if (value != null) events = value;\n\n      renderHello(events);\n      jump_to_today();\n    })\n    .catch(function (err) {\n      jump_to_today();\n    });\n\n  localforage\n    .getItem(\"subscriptions\")\n    .then(function (value) {\n      subscriptions = value;\n\n      setTimeout(function () {\n        if (subscriptions == null) return false;\n        load_subscriptions();\n        console.log(subscriptions);\n      }, 2000);\n    })\n    .catch(function (err) {\n      // This code runs if there were any errors\n      console.log(err);\n    });\n\n  localforage\n    .getItem(\"settings\")\n    .then(function (value) {\n      if (value == null) return false;\n      settings = value;\n      document.getElementById(\"default-notification-time\").value =\n        settings.default_notification;\n    })\n    .catch(function (err) {\n      // This code runs if there were any errors\n      console.log(err);\n    });\n\n  function handleVisibilityChange() {\n    if (document.visibilityState === \"hidden\") {\n      status.visible = false;\n    } else {\n      setTimeout(function () {\n        status.visible = true;\n      }, 1000);\n    }\n  }\n\n  handleVisibilityChange();\n\n  /////////////////\n  ///NAVIGATION\n  /////////////////\n\n  let nav = function (move) {\n    if (\n      document.activeElement.nodeName == \"SELECT\" ||\n      document.activeElement.type == \"date\" ||\n      document.activeElement.type == \"time\"\n    )\n      return false;\n    const currentIndex = document.activeElement.tabIndex;\n    let next = currentIndex + move;\n    let items = 0;\n\n    if (status.view == \"month\") {\n      let b = document.activeElement.parentNode.parentNode;\n      items = b.querySelectorAll(\".item\");\n    }\n\n    if (status.view == \"list-view\") {\n      let b = document.activeElement.parentNode;\n      items = b.querySelectorAll(\"div#list-view article\");\n    }\n\n    if (status.view == \"subscription\") {\n      items = document.querySelectorAll(\"div#subscription-form > div.item\");\n    }\n\n    if (status.view == \"add-edit-event\" || status.view == \"options\") {\n      let b = document.activeElement.parentNode;\n      items = b.querySelectorAll(\".item\");\n\n      if (\n        document.activeElement.parentNode.classList.contains(\"input-parent\")\n      ) {\n        document.activeElement.parentNode.focus();\n        return true;\n      } else {\n        document.getElementById(\"add-edit-event\").firstElementChild.focus();\n      }\n    }\n    let targetElement = 0;\n\n    if (next <= items.length) {\n      targetElement = items[next];\n      targetElement.focus();\n    }\n\n    if (next == items.length) {\n      targetElement = items[0];\n      targetElement.focus();\n    }\n\n    const rect = document.activeElement.getBoundingClientRect();\n    const elY =\n      rect.top - document.body.getBoundingClientRect().top + rect.height / 2;\n\n    document.activeElement.parentNode.scrollBy({\n      left: 0,\n      top: elY - window.innerHeight / 2,\n      behavior: \"smooth\",\n    });\n\n    if (status.view == \"month\" || status.view == \"list-view\") {\n      if (targetElement.hasAttribute(\"data-date\")) {\n        status.selected_day = targetElement.getAttribute(\"data-date\");\n        status.selected_day_id = targetElement.getAttribute(\"data-id\");\n        event_check_day(status.selected_day);\n      }\n      return true;\n    }\n\n    if (\n      document.activeElement.id == \"form-image-wrapper\" &&\n      status.view == \"add-edit-event\"\n    ) {\n      helper.bottom_bar(\"\", \"remove image\", \"\");\n      return true;\n    }\n\n    if (\n      document.activeElement.id != \"form-image-wrapper\" &&\n      status.view == \"add-edit-event\"\n    ) {\n      helper.bottom_bar(\"\", \"edit\", \"\");\n      return true;\n    }\n  };\n\n  // foram actions\n  // after selection\n\n  document\n    .getElementById(\"event-notification-time\")\n    .addEventListener(\"change\", (event) => {\n      setTimeout(function () {\n        document\n          .getElementById(\"event-notification-time\")\n          .parentElement.focus();\n      }, 500);\n    });\n\n  //default when is not set\n  settings.default_notification = \"none\";\n\n  document\n    .getElementById(\"default-notification-time\")\n    .addEventListener(\"change\", (event) => {\n      let l = document.getElementById(\"default-notification-time\").value;\n      settings.default_notification = l;\n\n      localforage\n        .setItem(\"settings\", settings)\n        .then(function (value) {})\n        .catch(function (err) {\n          console.log(err);\n        });\n\n      setTimeout(function () {\n        document\n          .getElementById(\"default-notification-time\")\n          .parentElement.focus();\n      }, 500);\n    });\n\n  document.querySelectorAll('input[type=\"time\"]').forEach(function (item) {\n    item.addEventListener(\"change\", (event) => {\n      setTimeout(function () {\n        item.parentElement.focus();\n      }, 500);\n    });\n  });\n\n  document.querySelectorAll('input[type=\"date\"]').forEach(function (item) {\n    item.addEventListener(\"change\", (event) => {\n      setTimeout(function () {\n        item.parentElement.focus();\n      }, 500);\n    });\n  });\n\n  let add_alarm = function (date, message_text, id) {\n   \n    // KaiOs  2.xx\n    if (navigator.mozAlarms) {\n      // This is arbitrary data pass to the alarm\n      var data = {\n        foo: message_text,\n        event_id: id,\n      };\n\n      // The \"honorTimezone\" string is what make the alarm honoring it\n\n      var request = navigator.mozAlarms.add(date, \"honorTimezone\", data);\n\n      request.onsuccess = function () {\n        // console.log(this.result);\n      };\n\n      request.onerror = function () {\n        console.log(\"An error occurred: \" + this.error.name);\n      };\n    }\n  };\n\n  // may better to compare all alarms\n  // with all events\n  // to clean\n  let remove_alarm = function (id) {\n\n\n    // KaiOs  2.xx\n\n    if (navigator.mozAlarms) {\n      let request = navigator.mozAlarms.getAll();\n\n      request.onsuccess = function () {\n        this.result.forEach(function (alarm) {\n          if (alarm.data.event_id == id) {\n            let req = navigator.mozAlarms.remove(alarm.id);\n\n            req.onsuccess = function () {\n              console.log(\"removed\");\n            };\n\n            req.onerror = function () {\n              console.log(\"An error occurred: \" + this.error.name);\n            };\n          } else {\n            console.log(\"no alarm founded\");\n          }\n        });\n      };\n\n      request.onerror = function () {\n        console.log(\"An error occurred:\", this.error.name);\n      };\n    }\n  };\n\n  let test_alarm = function () {\n    if (navigator.mozAlarms) {\n      var request = navigator.mozAlarms.getAll();\n\n      request.onsuccess = function () {\n        this.result.forEach(function (alarm) {\n          console.log(\"Id:\", alarm.id);\n          console.log(\"date:\", alarm.date);\n          console.log(\"respectTimezone:\", alarm.respectTimezone);\n          console.log(\"data:\", JSON.stringify(alarm.data));\n        });\n      };\n\n      request.onerror = function () {\n        console.log(\"An error occurred:\", this.error.name);\n      };\n    }\n  };\n\n  // //////////////////\n  // //BUILD EVENT-LIST\n  // /////////////////\n  // /////////////\n  // /////////////\n  // STORE EVENTS//\n  // /////////////\n  // /////////////\n\n  let convert_ics_date = function (t) {\n    let nn = t.replace(/-/g, \"\");\n    nn = nn.replace(/:/g, \"\");\n    nn = nn.replace(\" \", \"T\");\n    nn = nn + \"00\";\n    return nn;\n  };\n\n  let export_data = [];\n\n  let store_event = function () {\n    let start_time = \"00:00:00\";\n    if (document.getElementById(\"event-time-start\").value != \"\") {\n      start_time = document.getElementById(\"event-time-start\").value;\n    }\n\n    let end_time = \"00:00:00\";\n    if (document.getElementById(\"event-time-end\").value != \"\") {\n      end_time = document.getElementById(\"event-time-end\").value;\n    }\n\n    let convert_dt_start =\n      document.getElementById(\"event-date\").value + \" \" + start_time;\n\n    if (document.getElementById(\"event-date-end\").value == \"\")\n      document.getElementById(\"event-date-end\").value =\n        document.getElementById(\"event-date\").value;\n\n    let convert_dt_end =\n      document.getElementById(\"event-date-end\").value + \" \" + end_time;\n\n    // notification before event\n    let notification_time = document.getElementById(\n      \"event-notification-time\"\n    ).value;\n\n    let calc_notification;\n    if (notification_time != \"none\") {\n      calc_notification = new Date(convert_dt_start);\n      calc_notification.setMinutes(\n        calc_notification.getMinutes() - notification_time\n      );\n\n      notification_time = convert_ics_date(calc_notification.toISOString());\n    }\n\n    let multidayevent = false;\n\n    let a = new Date(document.getElementById(\"event-date\").value).getTime();\n    let b = new Date(document.getElementById(\"event-date-end\").value).getTime();\n\n    if (a != b) {\n      multidayevent = true;\n    }\n\n    let rrule_convert = function () {\n      let p = document.getElementById(\"event-recur\").value;\n      let r;\n      if (p != \"\" || p != \"none\") {\n        r =\n          \"FREQ=\" +\n          document.getElementById(\"event-recur\").value +\n          \";UNTIL=\" +\n          convert_ics_date(convert_dt_end);\n      }\n      return r;\n    };\n\n    let event = {\n      UID: helper.uid(),\n      SUMMARY: document.getElementById(\"event-title\").value,\n      LOCATION: document.getElementById(\"event-location\").value,\n      DESCRIPTION: document.getElementById(\"event-description\").value,\n      CLASS: \"PRIVATE\",\n      DTSTAMP: convert_ics_date(convert_dt_start),\n      DTSTART: convert_ics_date(convert_dt_start),\n      DTEND: convert_ics_date(convert_dt_end),\n      RRULE: rrule_convert(),\n      rrule_: document.getElementById(\"event-recur\").value,\n      dateStart: document.getElementById(\"event-date\").value,\n      dateEnd: document.getElementById(\"event-date-end\").value,\n      time_start: document.getElementById(\"event-time-start\").value,\n      time_end: document.getElementById(\"event-time-end\").value,\n      alarm: document.getElementById(\"event-notification-time\").value,\n      alarmTrigger: notification_time,\n      isSubscription: false,\n      multidayevent: multidayevent,\n      ATTACH: blob,\n    };\n\n    if (event.alarm != \"none\") {\n      event.BEGIN = \"VALARM\";\n      event[\"TRIGGER;VALUE=DATE-TIME\"] = notification_time;\n      event.ACTION = \"AUDIO\";\n      event.END = \"VALARM\";\n      add_alarm(calc_notification, event.SUMMARY, event.UID);\n    }\n\n    events.push(event);\n\n    let without_subscription = events.filter(\n      (events) => events.isSubscription === false\n    );\n\n    localforage\n      .setItem(\"events\", without_subscription)\n      .then(function (value) {\n        helper.toaster(\"saved\", 2000);\n\n        // clean form\n        clear_form();\n        renderHello(events);\n\n        eximport.export_ical(\"greg.ics\", without_subscription);\n      })\n      .catch(function (err) {});\n\n    status.view = \"month\";\n    router();\n  };\n\n  // ////////////\n  // UPDATE EVENT\n  // /////////\n\n  let update_event = function () {\n    events.forEach(function (index) {\n      let a = new Date(document.getElementById(\"event-date\").value).getTime();\n      let b = new Date(\n        document.getElementById(\"event-date-end\").value\n      ).getTime();\n\n      let multidayevent = false;\n\n      if (a != b) {\n        multidayevent = true;\n      }\n\n      if (index.UID == status.selected_day_id) {\n        let start_time = \"00:00:00\";\n        if (document.getElementById(\"event-time-start\").value != \"\") {\n          start_time = document.getElementById(\"event-time-start\").value;\n        }\n\n        let end_time = \"00:00:00\";\n        if (document.getElementById(\"event-time-end\").value != \"\") {\n          end_time = document.getElementById(\"event-time-end\").value;\n        }\n\n        let convert_dt_start =\n          document.getElementById(\"event-date\").value + \" \" + start_time;\n\n        let convert_dt_end =\n          document.getElementById(\"event-date\").value + \" \" + end_time;\n\n        // notification before event\n        let notification_time = document.getElementById(\n          \"event-notification-time\"\n        ).value;\n\n        let calc_notification = \"\";\n        if (notification_time != \"none\") {\n          calc_notification = new Date(convert_dt_start);\n          calc_notification.setMinutes(\n            calc_notification.getMinutes() - notification_time\n          );\n\n          notification_time = convert_ics_date(calc_notification.toISOString());\n        }\n\n        let rrule_convert = function () {\n          let p = document.getElementById(\"event-recur\").value;\n          let r;\n          if (p != \"\" || p != \"none\") {\n            r =\n              \"FREQ=\" +\n              document.getElementById(\"event-recur\").value +\n              \";UNTIL=\" +\n              convert_ics_date(convert_dt_end);\n          }\n          return r;\n        };\n\n        index.SUMMARY = document.getElementById(\"event-title\").value;\n        index.DESCRIPTION = document.getElementById(\"event-description\").value;\n        index.LOCATION = document.getElementById(\"event-location\").value;\n        index.DTSTART = convert_ics_date(convert_dt_start);\n        index.DTEND = convert_ics_date(convert_dt_end);\n        index.dateEnd = document.getElementById(\"event-date-end\").value;\n        index.dateStart = document.getElementById(\"event-date\").value;\n        index.time_start = document.getElementById(\"event-time-start\").value;\n        index.time_end = document.getElementById(\"event-time-end\").value;\n        index.RRULE = rrule_convert();\n        index.rrule_ = document.getElementById(\"event-recur\").value;\n        index.isSubscription = false;\n        index.multidayevent = multidayevent;\n        index.alarm = document.getElementById(\"event-notification-time\").value;\n        index.alarmTrigger = notification_time;\n        if (blob != \"\") index.ATTACH = blob;\n\n        if (index.alarm != \"none\") {\n          remove_alarm(index.UID);\n          index.BEGIN = \"VALARM\";\n          index[\"TRIGGER;VALUE=DATE-TIME:\"] = notification_time;\n          index.ACTION = \"AUDIO\";\n          index.END = \"VALARM\";\n          add_alarm(calc_notification, index.SUMMARY, index.UID);\n        }\n      }\n    });\n\n    let without_subscription = events.filter(\n      (events) => events.isSubscription === false\n    );\n\n    localforage\n      .setItem(\"events\", without_subscription)\n      .then(function (value) {\n        // clean form\n        renderHello(events);\n\n        eximport.export_ical(\"greg.ics\", value);\n        status.view = \"month\";\n        router();\n        clear_form();\n      })\n      .catch(function (err) {});\n  };\n\n  // ////////////\n\n  // EDIT EVENT\n\n  // /////////\n\n  let edit_event = function () {\n    document.getElementById(\"delete-event\").style.display = \"block\";\n    document.getElementById(\"export-event\").style.display = \"block\";\n\n    events.forEach(function (index) {\n      if (index.UID == status.selected_day_id) {\n        document.getElementById(\"event-title\").value = index.SUMMARY;\n        document.getElementById(\"event-date\").value = index.dateStart;\n        document.getElementById(\"event-date-end\").value = index.dateEnd;\n        document.getElementById(\"event-time-start\").value = index.time_start;\n        document.getElementById(\"event-time-end\").value = index.time_end;\n        document.getElementById(\"event-description\").value = index.DESCRIPTION;\n        document.getElementById(\"event-location\").value = index.LOCATION;\n        document.querySelector(\"#event-notification-time\").value = index.alarm;\n        document.getElementById(\"form-image\").src = index.ATTACH;\n        document.getElementById(\"event-recur\").value = index.rrule_;\n      }\n    });\n  };\n\n  //////////////\n  //DELETE EVENT\n  ///////////\n\n  let delete_event = function () {\n    let f = false;\n\n    events = events.filter((person) => person.UID != status.selected_day_id);\n    remove_alarm(status.selected_day_id);\n    f = true;\n\n    status.edit_event = false;\n    let without_subscription = events.filter(\n      (events) => events.isSubscription === false\n    );\n\n    clear_form();\n\n    localforage\n      .setItem(\"events\", without_subscription)\n      .then(function (value) {\n        renderHello(events);\n\n        eximport.export_ical(\"greg.ics\", value);\n      })\n      .catch(function (err) {\n        // This code runs if there were any errors\n        console.log(err);\n      });\n\n    return f;\n  };\n\n  // event slider\n  let t = new Date();\n  let m = `0${t.getMonth() + 1}`.slice(-2);\n  let d = `0${t.getDate()}`.slice(-2);\n  let y = t.getFullYear();\n  event_check_day(y + \"-\" + m + \"-\" + d);\n\n  // callback import event\n  let import_event = function (id, date) {\n    helper.toaster(\"done\", 2000);\n    helper.bottom_bar(\"edit\", \"\", \"\");\n\n    //renderHello(events);\n    let without_subscription = events.filter(\n      (events) => events.isSubscription === false\n    );\n\n    localforage\n      .setItem(\"events\", without_subscription)\n      .then(function (value) {\n        renderHello(events);\n\n        eximport.export_ical(\"greg.ics\", without_subscription);\n      })\n      .catch(function (err) {});\n  };\n\n  let set_datetime_form = function () {\n    let d = new Date();\n    let d_h = `0${d.getHours()}`.slice(-2);\n    let d_m = `0${d.getMinutes()}`.slice(-2);\n    let p = d_h + \":\" + d_m;\n\n    let d_h_ = `0${d.getHours() + 1}`.slice(-2);\n    let d_m_ = `0${d.getMinutes()}`.slice(-2);\n    if (d_h_ > 23) d_h_ = \"23\";\n\n    let pp = d_h_ + \":\" + d_m_;\n\n    document.getElementById(\"event-time-start\").value = p;\n    document.getElementById(\"event-time-end\").value = pp;\n  };\n\n  let pick_image_callback = function (resultBlob) {\n    let t = document.getElementById(\"form-image\");\n\n    t.src = URL.createObjectURL(resultBlob);\n    document.getElementById(\"form-image-wrapper\").classList.add(\"item\");\n\n    document\n      .querySelectorAll(\"div#add-edit-event .item\")\n      .forEach(function (i, p) {\n        i.setAttribute(\"tabindex\", p);\n      });\n\n    let fr = new FileReader();\n    fr.onload = function () {\n      blob = fr.result;\n    };\n    fr.readAsDataURL(resultBlob);\n  };\n\n  // ////////////////////////////\n  // //KEYPAD HANDLER////////////\n  // ////////////////////////////\n\n  let longpress = false;\n  const longpress_timespan = 1000;\n  let timeout;\n\n  function repeat_action(param) {\n    switch (param.key) {\n      case \"0\":\n        break;\n    }\n  }\n\n  // ////////////\n\n  // //LONGPRESS\n\n  // ///////////\n\n  function longpress_action(param) {\n    switch (param.key) {\n      case \"0\":\n        break;\n\n      case \"Backspace\":\n        window.close();\n        break;\n\n      case \"ArrowLeft\":\n        if (status.view == \"list-view\") {\n        }\n\n        break;\n    }\n  }\n\n  // /////////////\n  // //SHORTPRESS\n  // ////////////\n\n  function shortpress_action(param) {\n    switch (param.key) {\n      case \"*\":\n        jump_to_today();\n\n        break;\n\n      case \"ArrowUp\":\n        if (status.view == \"month\") {\n          nav(-7);\n        }\n        if (\n          status.view == \"add-edit-event\" ||\n          status.view == \"list-view\" ||\n          status.view == \"options\" ||\n          status.view == \"subscription\"\n        ) {\n          nav(-1);\n        }\n        break;\n      case \"ArrowDown\":\n        if (status.view == \"month\") {\n          nav(+7);\n        }\n        if (\n          status.view == \"add-edit-event\" ||\n          status.view == \"list-view\" ||\n          status.view == \"options\" ||\n          status.view == \"subscription\"\n        ) {\n          nav(+1);\n        }\n\n        break;\n      case \"ArrowRight\":\n        if (status.view != \"month\") return true;\n\n        nav(1);\n        break;\n      case \"ArrowLeft\":\n        if (status.view != \"month\") return true;\n\n        nav(-1);\n\n        break;\n\n      case \"1\":\n        previous();\n        break;\n      case \"3\":\n        next();\n        break;\n\n      case \"2\":\n        slider_navigation();\n        break;\n\n      case \"#\":\n        document\n          .querySelectorAll(\n            \"div#calendar div#calendar-body div div [class^='moon-phase-']\"\n          )\n          .forEach(function (e) {\n            e.classList.toggle(\"active\");\n          });\n        break;\n\n      case \"7\":\n        break;\n\n      case \"SoftRight\":\n      case \"Alt\":\n        console.log(status.view);\n        if (status.view == \"month\") {\n          status.view = \"options\";\n          router();\n\n          return true;\n        }\n\n        if (status.view == \"subscription\") {\n          // store subscription\n          store_subscription();\n          return true;\n        }\n        break;\n\n      case \"SoftLeft\":\n      case \"Control\":\n        if (status.view == \"list-view\") {\n          if (document.activeElement.classList.contains(\"subscription\")) {\n            helper.toaster(\"a subscription cannot be edited\", 2000);\n            return false;\n          }\n\n          status.selected_day_id =\n            document.activeElement.getAttribute(\"data-id\");\n\n          status.edit_event = true;\n\n          edit_event();\n          status.view = \"add-edit-event\";\n          router();\n        }\n        if (status.view == \"subscription\") {\n          qr.start_scan(callback_scan);\n          return true;\n        }\n\n        if (status.view == \"options\") {\n          delete_subscription();\n          return true;\n        }\n\n        if (status.view == \"month\") {\n          status.view = \"add-edit-event\";\n          router();\n\n          // when new event\n\n          // set time\n          set_datetime_form();\n\n          return true;\n        }\n        break;\n\n      case \"Enter\":\n        if (!status.visible) return false;\n\n        if (document.activeElement.classList.contains(\"input-parent\")) {\n          document.activeElement.children[1].focus();\n          return true;\n        }\n\n        if (document.activeElement.id == \"export-event\") {\n          events.forEach(function (index) {\n            if (index.UID == status.selected_day_id) {\n              export_data.push(index);\n            }\n          });\n\n          eximport.export_ical(export_data[0].UID + \".ics\", export_data);\n          helper.toaster(\"event exported\", 2000);\n\n          return true;\n        }\n\n        if (document.activeElement.id == \"select-image\") {\n          helper.pick_image(pick_image_callback);\n          return true;\n        }\n\n        if (document.activeElement.id == \"form-image-wrapper\") {\n          document.getElementById(\"form-image\").src = \"\";\n          blob = \"\";\n          return true;\n        }\n\n        if (\n          document.activeElement.getAttribute(\"data-function\") ==\n          \"add-subscription\"\n        ) {\n          status.view = \"subscription\";\n          router();\n          return true;\n        }\n\n        // same button with different text and action\n        if (document.activeElement.id == \"save-event\") {\n          if (status.edit_event) {\n            update_event();\n          } else {\n            store_event();\n          }\n\n          return true;\n        }\n\n        if (document.activeElement.id == \"delete-event\") {\n          if (delete_event()) {\n            status.view = \"month\";\n            router();\n          }\n          return true;\n        }\n\n        if (status.view == \"options\") {\n          if (\n            document.activeElement.getAttribute(\"data-function\") == \"export\"\n          ) {\n            localforage\n              .getItem(\"events\")\n              .then(function (value) {\n                eximport.export_ical(\"greg.ics\", value);\n              })\n              .catch(function (err) {\n                console.log(err);\n              });\n          }\n\n          if (\n            document.activeElement.getAttribute(\"data-function\") == \"import\"\n          ) {\n            eximport.loadICS(\n              document.activeElement.getAttribute(\"data-filename\"),\n              import_event\n            );\n          }\n          return true;\n        }\n        if (status.view == \"month\" || status.view == \"list-view\")\n          router(\"view\");\n\n        break;\n\n      case \"Backspace\":\n        if (\n          status.view == \"add-edit-event\" &&\n          document.activeElement.tagName != \"INPUT\"\n        ) {\n          status.view = \"month\";\n          router();\n        }\n\n        if (status.view == \"options\") {\n          status.view = \"month\";\n          router();\n        }\n\n        if (status.view == \"scan\") {\n          status.views = \"subscription\";\n          router();\n        }\n\n        break;\n    }\n  }\n\n  // ///////////////////////////////\n  // //shortpress / longpress logic\n  // //////////////////////////////\n\n  function handleKeyDown(evt) {\n    option_button_bar();\n    if (evt.key === \"Backspace\") {\n      if (\n        status.view == \"options\" ||\n        status.view == \"add-edit-event\" ||\n        status.view == \"scan\"\n      ) {\n        evt.preventDefault();\n      }\n    }\n\n    if (evt.key === \"EndCall\") {\n      evt.preventDefault();\n      window.close();\n    }\n    if (!evt.repeat) {\n      longpress = false;\n      timeout = setTimeout(() => {\n        longpress = true;\n        longpress_action(evt);\n      }, longpress_timespan);\n    }\n\n    if (evt.repeat) {\n      if (evt.key == \"Backspace\") longpress = false;\n\n      repeat_action(evt);\n    }\n  }\n\n  function handleKeyUp(evt) {\n    if (status.visible === false) return false;\n\n    if (evt.key == \"Backspace\" && document.activeElement.tagName == \"INPUT\") {\n    }\n\n    clearTimeout(timeout);\n    if (!longpress) {\n      shortpress_action(evt);\n    }\n  }\n\n  document.addEventListener(\"keydown\", handleKeyDown);\n  document.addEventListener(\"keyup\", handleKeyUp);\n\n  document.addEventListener(\"visibilitychange\", handleVisibilityChange, false);\n\n\nnavigator.serviceWorker\n  .register(\"service-worker.js\")\n  .then((reg) => {\n    // registration worked\n    console.log(\"Registration succeeded. Scope is \" + reg.scope);\n  })\n  .catch((error) => {\n    // registration failed\n    console.log(\"Registration failed with \" + error);\n  });\n"]}