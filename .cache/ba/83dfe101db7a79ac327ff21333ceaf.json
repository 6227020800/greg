{"id":"Focm","dependencies":[{"name":"/home/strukturart/Desktop/Pages/greg/package.json","includedInParent":true,"mtime":1644529722435},{"name":"./service-worker.js","dynamic":true,"resolved":"/home/strukturart/Desktop/Pages/greg/application/service-worker.js","entry":true,"isolated":true,"loc":{"line":561,"column":35,"index":14518},"parent":"/home/strukturart/Desktop/Pages/greg/application/index.js"}],"generated":{"js":"\"use strict\";function e(t){return(e=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(t)}var t=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],n=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],a=new Date,i=a.getMonth(),o=a.getFullYear(),r=a.getDate(),c=document.getElementById(\"monthAndYear\"),d=!1,l={view:\"month\",selected_day:\"\",visible:!1,update_event_id:\"\"},u={},s=\"\",m=[];navigator.serviceWorker.register(\"/01a188ba384d97c9146a2ec456a0c6d3.js\").then(function(e){console.log(\"Registration succeeded. Scope is \"+e.scope)}).catch(function(e){console.log(\"Registration failed with \"+e)});var v,g=function(e){if(!navigator.mozApps)return!1;var t=navigator.mozApps.getSelf();t.onsuccess=function(){e(t.result)},t.onerror=function(){}};function f(e){v=e.origin;var t=document.getElementById(\"KaiOsAds-Wrapper\");\"app://kaios-plus.kaiostech.com\"==e.installOrigin?document.querySelector(\"#KaiOsAds-Wrapper iframe\").src=\"ads.html\":(console.log(\"Ads free\"),t.style.display=\"none\")}g(f);var y=function(e){for(var t=0,n=new Date(e).getTime(),a=0;a<m.length;a++){n<new Date(m[a].dateStart).getTime()&&(t=m[a-1].dateStart,a=m.length),n>new Date(m[m.length-1].dateStart).getTime()&&(t=m[m.length-1].dateStart,a=m.length)}return document.querySelectorAll(\"div#list-view article[data-date='\"+t+\"']\")[0].focus(),t},p=function(t){for(var n={date:\"\",event:!1,subscription:!1,multidayevent:!1,rrule:\"none\"},a=0;a<m.length;a++)if(\"object\"===e(m[a])){n.event=!1,n.subscription=!1,n.multidayevent=!1,n.rrule=!1,n.date=t;var i=new Date(m[a].dateStart).getTime(),o=new Date(m[a].dateEnd).getTime(),r=new Date(t).getTime();\"none\"==m[a].rrule_&&(i===r||o===r||i<r&&o>r)&&(n.event=!0,!0===m[a].isSubscription&&(n.subscription=!0),!0===m[a].multidayevent&&(n.multidayevent=!0),a=m.length)}return n},E=function(t){for(var n={date:\"\",event:!1,subscription:!1,multidayevent:!1,rrule:\"none\"},a=0;a<m.length;a++)if(\"object\"===e(m[a])){n.event=!1,n.subscription=!1,n.multidayevent=!1,n.rrule=!1,n.date=t;new Date(m[a].dateStart).getTime(),new Date(m[a].dateEnd).getTime(),new Date(t).getTime();if(void 0!==m[a].rrule_&&void 0!==m[a].rrule_&&new Date(m[a].dateStart).getTime()<=new Date(t).getTime()&&new Date(t).getTime()<=new Date(m[a].dateEnd).getTime()){if(\"MONTHLY\"==m[a].rrule_&&new Date(m[a].dateStart).getDate()===new Date(t).getDate())return n.rrule=!0,a=m.length,n;if(\"DAILY\"==m[a].rrule_)return n.rrule=!0,a=m.length,n;if(\"WEEKLY\"==m[a].rrule_&&new Date(m[a].dateStart).getDay()===new Date(t).getDay())return n.rrule=!0,a=m.length,n;if(\"YEARLY\"==m[a].rrule_){var i=new Date(m[a].dateStart),o=new Date(t);if(i.getDate()+\"-\"+i.getMonth()==o.getDate()+\"-\"+o.getMonth())return n.rrule=!0,a=m.length,n}}}return n},b=[],h=0,A=function(e){b=[];var t=document.querySelector(\"div#event-slider-indicator div\");t.innerHTML=\"\";for(var n=document.querySelectorAll(\"div#event-slider article\"),a=0;a<n.length;a++)n[a].style.display=\"none\";for(var i=document.querySelectorAll(\"div#event-slider article\"),o=0;o<i.length;o++){var r=new Date(i[o].getAttribute(\"data-date\")).getTime(),c=new Date(i[o].getAttribute(\"data-date-end\")).getTime(),d=new Date(e).getTime(),l=i[o].getAttribute(\"data-rrule\");if(\"none\"===l||\"\"===l)(r===d||c===d||r<d&&c>d)&&(b.push(i[o]),b[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"));else if(r===d||c===d||r<d&&c>d&&l){if(\"YEARLY\"==l){var u=new Date(i[o].getAttribute(\"data-date\")),s=new Date(e);u.getDate()+\"-\"+u.getMonth()==s.getDate()+\"-\"+s.getMonth()&&(b.push(i[o]),b[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"))}\"WEEKLY\"==l&&new Date(i[o].getAttribute(\"data-date\")).getDay()==new Date(e).getDay()&&(b.push(i[o]),b[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\")),\"MONTHLY\"==l&&new Date(i[o].getAttribute(\"data-date\")).getDate()==new Date(e).getDate()&&(b.push(i[o]),b[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\")),\"DAILY\"==l&&(r===d||c===d||r<d&&c>d)&&(b.push(i[o]),b[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"))}}\"\"!=b&&b.length>0?t.style.opacity=100:t.style.opacity=0},w=function(){var e=document.querySelectorAll(\"div#event-slider-indicator div div\");h==b.length-1&&(h=-1),h++,b.forEach(function(e){e.style.display=\"none\"}),b[h].style.display=\"block\",e.forEach(function(e){e.classList.remove(\"active\")}),e[h].classList.add(\"active\")},I=function(){var e=a.getMonth(),t=a.getFullYear();T(e,t),console.log(e),A(l.selected_day),l.selected_day=document.activeElement.getAttribute(\"data-date\")};function B(){o=11===i?o+1:o,T(i=(i+1)%12,o),A(l.selected_day)}function D(){o=0===i?o-1:o,T(i=0===i?11:i-1,o),A(l.selected_day)}Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)};var T=function(e,n){helper.bottom_bar(\"add\",\"events\",\"options\");var i=new Date(n,e).getDay(),o=32-new Date(n,e,32).getDate(),d=document.getElementById(\"calendar-body\");d.innerHTML=\"\",c.innerHTML=t[e]+\" \"+n;for(var u=1,s=0;s<6;s++){var v=document.createElement(\"div\");v.classList.add(\"flex\"),v.classList.add(\"row\"),v.classList.add(\"width-100\");for(var g=0;g<7;g++)if(0===s&&g<i){var f=document.createElement(\"div\"),y=document.createTextNode(\"\");f.appendChild(y),v.appendChild(f)}else{if(u>o)break;var b=document.createElement(\"div\"),h=document.createElement(\"span\"),A=document.createElement(\"div\"),w=document.createTextNode(u);b.appendChild(w),b.appendChild(h),b.setAttribute(\"tabindex\",u-1);var I=n+\"-\"+\"0\".concat(e+1).slice(-2)+\"-\"+\"0\".concat(u).slice(-2);A.classList.add(\"moon-phase-\"+getMoonPhase(n,e,u)),b.appendChild(A),b.setAttribute(\"data-date\",I),b.setAttribute(\"data-index\",new Date(I).toISOString()),m.length>0&&(p(I).event&&b.classList.add(\"event\"),E(I).rrule&&b.classList.add(\"event\"),1==p(I).subscription&&b.classList.add(\"subscription\")),b.classList.add(\"item\"),v.appendChild(b),u++}var B=document.createElement(\"span\");B.classList.add(\"weeknumber\");var D=document.createTextNode(new Date(n,e,u).getWeek());B.appendChild(D),v.appendChild(B),d.appendChild(v)}document.querySelectorAll(\".item\")[0].focus(),l.selected_day=document.activeElement.getAttribute(\"data-date\"),a.getMonth()==e&&a.getFullYear()==n&&(document.querySelectorAll(\".item\")[r-1].focus(),document.querySelectorAll(\".item\")[r-1].classList.add(\"today\"))},S=function(){document.querySelectorAll(\"div#list-view article\").forEach(function(e,t){e.setAttribute(\"tabindex\",t)})};function _(e){document.getElementById(\"event-slider\").style.opacity=0,helper.sort_array(e,\"dateStart\",\"date\");var a=document.getElementById(\"template\").innerHTML,i=Mustache.render(a,{data:e});document.getElementById(\"list-view\").innerHTML=i,document.getElementById(\"event-slider\").innerHTML=i,document.getElementById(\"event-slider\").style.opacity=100,S(),document.querySelectorAll(\"article\").forEach(function(e){var a=new Date(e.getAttribute(\"data-date\")),i=new Date(e.getAttribute(\"data-date-end\")),o=n[a.getDay()]+\", \"+a.getFullYear()+\" \"+t[a.getMonth()]+\" \"+a.getDate(),r=n[i.getDay()]+\", \"+i.getFullYear()+\" \"+t[i.getMonth()]+\" \"+i.getDate();e.classList.contains(\"multidayevent\")?e.querySelector(\"div.date\").innerText=o+\" - \"+r:e.querySelector(\"div.date\").innerText=o})}\"b2g.alarmManager\"in navigator&&navigator.serviceWorker.register(\"/01a188ba384d97c9146a2ec456a0c6d3.js\").then(function(e){e.systemMessageManager.subscribe(\"alarm\").then(function(e){console.log('Successfully subscribe system messages of name \"alarm\".')},function(e){console.log(\"Fail to subscribe system message, error: \"+e)})});var L=function(){Array.from(document.querySelectorAll(\"div#add-edit-event input\")).forEach(function(e){e.value=\"\",document.getElementById(\"form-image\").src=\"\",s=\"\"})},M=document.getElementById(\"calendar\"),k=document.getElementById(\"add-edit-event\"),R=document.getElementById(\"list-view\"),q=document.getElementById(\"options\"),x=function(){setTimeout(function(){if(\"options\"==l.view)return\"subscription\"==document.activeElement.getAttribute(\"data-function\")?(helper.bottom_bar(\"delete\",\"select\",\"\"),!0):(helper.bottom_bar(\"\",\"select\",\"\"),!0)},500)},N=document.querySelectorAll(\".page\"),C=function(e){if(Array.from(N).forEach(function(e){e.style.display=\"none\"}),\"view\"==e&&(\"month\"==l.view?l.view=\"list-view\":l.view=\"month\"),\"add-edit-event\"==l.view)return document.activeElement.hasAttribute(\"data-date\")&&(l.selected_day=document.activeElement.getAttribute(\"data-date\")),document.getElementById(\"event-date\").value=l.selected_day,k.style.display=\"block\",Array.from(document.querySelectorAll(\"div#add-edit-event .item\")).forEach(function(e,t){e.setAttribute(\"tabindex\",t)}),k.querySelectorAll(\".item\")[0].focus(),helper.bottom_bar(\"\",\"edit\",\"\"),\"\"==document.getElementById(\"event-date-end\").value&&(document.getElementById(\"event-date-end\").value=document.getElementById(\"event-date\").value),l.edit_event&&(document.getElementById(\"save-event\").innerText=\"update\"),console.log(l.edit_event),l.edit_event||(document.getElementById(\"save-event\").innerText=\"save\",document.getElementById(\"event-notification-time\").value=u.default_notification),!0;if(\"month\"==l.view){document.activeElement.hasAttribute(\"data-date\")&&(l.selected_day=document.activeElement.getAttribute(\"data-date\")),q.style.display=\"none\",M.style.display=\"block\",helper.bottom_bar(\"add\",\"events\",\"options\"),l.edit_event=!1;var t=new Date(l.selected_day);i=t.getMonth(),o=t.getFullYear();var n=l.selected_day;T(i,o),Array.from(document.querySelectorAll(\"div#calendar-body div.item\")).forEach(function(e){e.getAttribute(\"data-date\")==n&&(e.focus(),A(n))}),L()}\"list-view\"==l.view&&(document.activeElement.hasAttribute(\"data-date\")&&(l.selected_day=document.activeElement.getAttribute(\"data-date\")),q.style.display=\"none\",l.edit_event=!1,L(),helper.bottom_bar(\"edit\",\"month\",\"options\"),R.style.display=\"block\",setTimeout(function(){for(var e=document.querySelectorAll(\"div#list-view article\"),t=!1,n=0;n<e.length;n++)e[n].getAttribute(\"data-date\")==l.selected_day&&(e[n].focus(),n=e.length,t=!0);for(n=0;n<e.length;n++)console.log(e[n].getAttribute(\"data-alarm\")),\"none\"==e[n].getAttribute(\"data-alarm\")&&(e[n].querySelector(\"img.bell\").style.display=\"none\");t||(document.querySelectorAll(\"div#list-view article\")[0].focus(),y(l.selected_day));var a=document.activeElement.getBoundingClientRect(),i=a.top-document.body.getBoundingClientRect().top+a.height/2;document.activeElement.parentNode.scrollBy({left:0,top:i-window.innerHeight/2,behavior:\"smooth\"})},1e3)),\"options\"==l.view&&(document.activeElement.hasAttribute(\"data-date\")&&(l.selected_day=document.activeElement.getAttribute(\"data-date\")),d||(eximport.list_ics(),U(),d=!0),document.getElementById(\"options\").style.display=\"block\",document.querySelectorAll(\"div#options .item\")[0].focus(),document.getElementById(\"options\").style.opacity=\"1\",document.getElementById(\"subscription-form\").style.display=\"none\",setTimeout(function(){Array.from(document.querySelectorAll(\"div#options .item\")).forEach(function(e,t){e.setAttribute(\"tabindex\",t)})},2e3),x()),\"subscription\"==l.view&&(document.getElementById(\"options\").style.opacity=\"0.3\",document.getElementById(\"subscription-form\").style.display=\"block\",document.querySelectorAll(\"div#subscription-form div.item input\")[0].focus(),helper.bottom_bar(\"QR\",\"\",\"save\"))},U=function(){if(null==F)return!1;F.forEach(function(e){document.querySelector(\"div#options div#subscription-text\").insertAdjacentHTML(\"afterend\",'<button class=\"item dynamic\" data-function=\"subscription\">'+e.name+\"</button>\"),Array.from(document.querySelectorAll(\"div#options button\")).forEach(function(e,t){e.setAttribute(\"tabindex\",t)})})},O=0,Y=function e(){if(console.log(F),null==F||-1==F.lenght||\"undefined\"==F.lenght)return!1;O<F.length&&(eximport.fetch_ics(F[O].url,e),O++,helper.toaster(\"subscriptions loaded\",2e3)),I(),_(m),A(document.activeElement.getAttribute(\"data-date\")),document.activeElement.hasAttribute(\"data-date\")&&(l.selected_day=document.activeElement.getAttribute(\"data-date\"))},H=function(e){helper.bottom_bar(\"QR\",\"save\",\"cancel\"),document.querySelector(\"div#subscription-form input#cal-subs-url\").value=e},F=new Array,j=function(){console.log(F),helper.validate(document.getElementById(\"cal-subs-url\").value)&&\"\"!=document.getElementById(\"cal-subs-name\").value?((F=[]).push({url:document.getElementById(\"cal-subs-url\").value,name:document.getElementById(\"cal-subs-name\").value}),document.querySelector(\"input#cal-subs-name\").val=\"\",document.querySelector(\"input#cal-subs-url\").val=\"\",localforage.setItem(\"subscriptions\",F).then(function(e){document.getElementById(\"subscription-form\").style.display=\"none\",helper.toaster(\"subscription stored\",2e3),l.view=\"options\",C()}).catch(function(e){console.log(e)}),Y(),U()):helper.toaster(\"Please enter a name and a valid url\",2e3)},W=function(){var e=F.filter(function(e){return e.name!=document.activeElement.innerText});localforage.setItem(\"subscriptions\",e).then(function(e){console.log(\"saved: \"+e),helper.toaster(\"subscription deleted\",2e3),l.view=\"month\",C()}).catch(function(e){helper.toaster(e,2e3)}),document.activeElement.remove()};function z(){\"hidden\"===document.visibilityState?l.visible=!1:setTimeout(function(){l.visible=!0},1e3)}localforage.getItem(\"events\").then(function(e){null!=e&&(m=e),_(m),I()}).catch(function(e){I()}),localforage.getItem(\"subscriptions\").then(function(e){F=e,setTimeout(function(){if(null==F)return!1;Y(),console.log(F)},2e3)}).catch(function(e){console.log(e)}),localforage.getItem(\"settings\").then(function(e){if(null==e)return!1;u=e,document.getElementById(\"default-notification-time\").value=u.default_notification}).catch(function(e){console.log(e)}),document.addEventListener(\"DOMContentLoaded\",function(e){z();var t=function(e){if(\"SELECT\"==document.activeElement.nodeName||\"date\"==document.activeElement.type||\"time\"==document.activeElement.type)return!1;var t=document.activeElement.tabIndex+e,n=0;\"month\"==l.view&&(n=document.activeElement.parentNode.parentNode.querySelectorAll(\".item\"));\"list-view\"==l.view&&(n=document.activeElement.parentNode.querySelectorAll(\"div#list-view article\"));if(\"subscription\"==l.view&&(n=document.querySelectorAll(\"div#subscription-form > div.item\")),\"add-edit-event\"==l.view||\"options\"==l.view){if(n=document.activeElement.parentNode.querySelectorAll(\".item\"),document.activeElement.parentNode.classList.contains(\"input-parent\"))return document.activeElement.parentNode.focus(),!0;document.getElementById(\"add-edit-event\").firstElementChild.focus()}var a=0;t<=n.length&&(a=n[t]).focus(),t==n.length&&(a=n[0]).focus();var i=document.activeElement.getBoundingClientRect(),o=i.top-document.body.getBoundingClientRect().top+i.height/2;return document.activeElement.parentNode.scrollBy({left:0,top:o-window.innerHeight/2,behavior:\"smooth\"}),\"month\"==l.view||\"list-view\"==l.view?(a.hasAttribute(\"data-date\")&&(l.selected_day=a.getAttribute(\"data-date\"),l.selected_day_id=a.getAttribute(\"data-id\"),A(l.selected_day)),!0):\"form-image-wrapper\"==document.activeElement.id&&\"add-edit-event\"==l.view?(helper.bottom_bar(\"\",\"remove image\",\"\"),!0):\"form-image-wrapper\"!=document.activeElement.id&&\"add-edit-event\"==l.view?(helper.bottom_bar(\"\",\"edit\",\"\"),!0):void 0};document.getElementById(\"event-notification-time\").addEventListener(\"change\",function(e){setTimeout(function(){document.getElementById(\"event-notification-time\").parentElement.focus()},500)}),u.default_notification=\"none\",document.getElementById(\"default-notification-time\").addEventListener(\"change\",function(e){var t=document.getElementById(\"default-notification-time\").value;u.default_notification=t,localforage.setItem(\"settings\",u).then(function(e){}).catch(function(e){console.log(e)}),setTimeout(function(){document.getElementById(\"default-notification-time\").parentElement.focus()},500)}),document.querySelectorAll('input[type=\"time\"]').forEach(function(e){e.addEventListener(\"change\",function(t){setTimeout(function(){e.parentElement.focus()},500)})}),document.querySelectorAll('input[type=\"date\"]').forEach(function(e){e.addEventListener(\"change\",function(t){setTimeout(function(){e.parentElement.focus()},500)})});var n=function(e,t,n){if(navigator.serviceWorker.ready.then(function(e){console.log(e)}),\"b2g.alarmManager\"in navigator){var a={foo:t,event_id:n};(i=navigator.b2g.alarmManager.add(e,\"honorTimezone\",a)).onsuccess=function(){},i.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}else console.log(\"API not aviable\");if(navigator.mozAlarms){var i;a={foo:t,event_id:n};(i=navigator.mozAlarms.add(e,\"honorTimezone\",a)).onsuccess=function(){},i.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}},a=function(e){if(\"b2g.alarmManager\"in navigator){var t=navigator.b2g.alarmManager.getAll();t.onsuccess=function(){this.result.forEach(function(t){if(t.data.event_id==e){var n=navigator.b2g.alarmManager.remove(t.id);n.onsuccess=function(){console.log(\"removed\")},n.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}else console.log(\"no alarm founded\")})},t.onerror=function(){console.log(\"An error occurred:\",this.error.name)}}if(navigator.mozAlarms){var n=navigator.mozAlarms.getAll();n.onsuccess=function(){this.result.forEach(function(t){if(t.data.event_id==e){var n=navigator.mozAlarms.remove(t.id);n.onsuccess=function(){console.log(\"removed\")},n.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}else console.log(\"no alarm founded\")})},n.onerror=function(){console.log(\"An error occurred:\",this.error.name)}}},i=function(e){var t=e.replace(/-/g,\"\");return t=(t=t.replace(/:/g,\"\")).replace(\" \",\"T\"),t+=\"00\"},o=[],r=function(){var e=\"00:00:00\";\"\"!=document.getElementById(\"event-time-start\").value&&(e=document.getElementById(\"event-time-start\").value);var t=\"00:00:00\";\"\"!=document.getElementById(\"event-time-end\").value&&(t=document.getElementById(\"event-time-end\").value);var a=document.getElementById(\"event-date\").value+\" \"+e;\"\"==document.getElementById(\"event-date-end\").value&&(document.getElementById(\"event-date-end\").value=document.getElementById(\"event-date\").value);var o,r=document.getElementById(\"event-date-end\").value+\" \"+t,c=document.getElementById(\"event-notification-time\").value;\"none\"!=c&&((o=new Date(a)).setMinutes(o.getMinutes()-c),c=i(o.toISOString()));var d=!1;new Date(document.getElementById(\"event-date\").value).getTime()!=new Date(document.getElementById(\"event-date-end\").value).getTime()&&(d=!0);var u,v,g={UID:helper.uid(),SUMMARY:document.getElementById(\"event-title\").value,LOCATION:document.getElementById(\"event-location\").value,DESCRIPTION:document.getElementById(\"event-description\").value,CLASS:\"PRIVATE\",DTSTAMP:i(a),DTSTART:i(a),DTEND:i(r),RRULE:(v=document.getElementById(\"event-recur\").value,\"\"==v&&\"none\"==v||(u=\"FREQ=\"+document.getElementById(\"event-recur\").value+\";UNTIL=\"+i(r)),u),rrule_:document.getElementById(\"event-recur\").value,dateStart:document.getElementById(\"event-date\").value,dateEnd:document.getElementById(\"event-date-end\").value,time_start:document.getElementById(\"event-time-start\").value,time_end:document.getElementById(\"event-time-end\").value,alarm:document.getElementById(\"event-notification-time\").value,alarmTrigger:c,isSubscription:!1,multidayevent:d,ATTACH:s};\"none\"!=g.alarm&&(g.BEGIN=\"VALARM\",g[\"TRIGGER;VALUE=DATE-TIME\"]=c,g.ACTION=\"AUDIO\",g.END=\"VALARM\",n(o,g.SUMMARY,g.UID)),m.push(g);var f=m.filter(function(e){return!1===e.isSubscription});localforage.setItem(\"events\",f).then(function(e){helper.toaster(\"saved\",2e3),L(),_(m),eximport.export_ical(\"greg.ics\",f)}).catch(function(e){}),l.view=\"month\",C()},c=function(){m.forEach(function(e){var t,o,r=!1;if(new Date(document.getElementById(\"event-date\").value).getTime()!=new Date(document.getElementById(\"event-date-end\").value).getTime()&&(r=!0),e.UID==l.selected_day_id){var c=\"00:00:00\";\"\"!=document.getElementById(\"event-time-start\").value&&(c=document.getElementById(\"event-time-start\").value);var d=\"00:00:00\";\"\"!=document.getElementById(\"event-time-end\").value&&(d=document.getElementById(\"event-time-end\").value);var u=document.getElementById(\"event-date\").value+\" \"+c,m=document.getElementById(\"event-date\").value+\" \"+d,v=document.getElementById(\"event-notification-time\").value,g=\"\";\"none\"!=v&&((g=new Date(u)).setMinutes(g.getMinutes()-v),v=i(g.toISOString()));e.SUMMARY=document.getElementById(\"event-title\").value,e.DESCRIPTION=document.getElementById(\"event-description\").value,e.LOCATION=document.getElementById(\"event-location\").value,e.DTSTART=i(u),e.DTEND=i(m),e.dateEnd=document.getElementById(\"event-date-end\").value,e.dateStart=document.getElementById(\"event-date\").value,e.time_start=document.getElementById(\"event-time-start\").value,e.time_end=document.getElementById(\"event-time-end\").value,e.RRULE=(\"\"==(o=document.getElementById(\"event-recur\").value)&&\"none\"==o||(t=\"FREQ=\"+document.getElementById(\"event-recur\").value+\";UNTIL=\"+i(m)),t),e.rrule_=document.getElementById(\"event-recur\").value,e.isSubscription=!1,e.multidayevent=r,e.alarm=document.getElementById(\"event-notification-time\").value,e.alarmTrigger=v,\"\"!=s&&(e.ATTACH=s),\"none\"!=e.alarm&&(a(e.UID),e.BEGIN=\"VALARM\",e[\"TRIGGER;VALUE=DATE-TIME:\"]=v,e.ACTION=\"AUDIO\",e.END=\"VALARM\",n(g,e.SUMMARY,e.UID))}});var e=m.filter(function(e){return!1===e.isSubscription});localforage.setItem(\"events\",e).then(function(e){_(m),eximport.export_ical(\"greg.ics\",e),l.view=\"month\",C(),L()}).catch(function(e){})},d=function(){document.getElementById(\"delete-event\").style.display=\"block\",document.getElementById(\"export-event\").style.display=\"block\",m.forEach(function(e){e.UID==l.selected_day_id&&(document.getElementById(\"event-title\").value=e.SUMMARY,document.getElementById(\"event-date\").value=e.dateStart,document.getElementById(\"event-date-end\").value=e.dateEnd,document.getElementById(\"event-time-start\").value=e.time_start,document.getElementById(\"event-time-end\").value=e.time_end,document.getElementById(\"event-description\").value=e.DESCRIPTION,document.getElementById(\"event-location\").value=e.LOCATION,document.querySelector(\"#event-notification-time\").value=e.alarm,document.getElementById(\"form-image\").src=e.ATTACH,document.getElementById(\"event-recur\").value=e.rrule_)})},v=function(){m=m.filter(function(e){return e.UID!=l.selected_day_id}),a(l.selected_day_id),l.edit_event=!1;var e=m.filter(function(e){return!1===e.isSubscription});return L(),localforage.setItem(\"events\",e).then(function(e){_(m),eximport.export_ical(\"greg.ics\",e)}).catch(function(e){console.log(e)}),!0},g=new Date,f=\"0\".concat(g.getMonth()+1).slice(-2),y=\"0\".concat(g.getDate()).slice(-2),p=g.getFullYear();A(p+\"-\"+f+\"-\"+y);var E,b=function(e,t){helper.bottom_bar(\"edit\",\"\",\"\");var n=m.filter(function(e){return!1===e.isSubscription});localforage.setItem(\"events\",n).then(function(e){_(m),eximport.export_ical(\"greg.ics\",n)}).catch(function(e){})},h=function(){var e=new Date,t=\"0\".concat(e.getHours()).slice(-2)+\":\"+\"0\".concat(e.getMinutes()).slice(-2),n=\"0\".concat(e.getHours()+1).slice(-2);n>23&&(n=\"23\");var a=n+\":\"+\"0\".concat(e.getMinutes()).slice(-2);document.getElementById(\"event-time-start\").value=t,document.getElementById(\"event-time-end\").value=a},T=function(e){document.getElementById(\"form-image\").src=URL.createObjectURL(e),document.getElementById(\"form-image-wrapper\").classList.add(\"item\"),document.querySelectorAll(\"div#add-edit-event .item\").forEach(function(e,t){e.setAttribute(\"tabindex\",t)});var t=new FileReader;t.onload=function(){s=t.result},t.readAsDataURL(e)},S=!1,M=1e3;document.addEventListener(\"keydown\",function(e){x(),\"Backspace\"===e.key&&(\"options\"!=l.view&&\"add-edit-event\"!=l.view&&\"scan\"!=l.view||e.preventDefault()),\"EndCall\"===e.key&&(e.preventDefault(),window.close()),e.repeat||(S=!1,E=setTimeout(function(){S=!0,function(e){switch(e.key){case\"0\":break;case\"Backspace\":window.close();break;case\"ArrowLeft\":l.view}}(e)},M)),e.repeat&&(\"Backspace\"==e.key&&(S=!1),e.key)}),document.addEventListener(\"keyup\",function(e){if(!1===l.visible)return!1;\"Backspace\"==e.key&&document.activeElement.tagName,clearTimeout(E),S||function(e){switch(e.key){case\"*\":I();break;case\"ArrowUp\":\"month\"==l.view&&t(-7),\"add-edit-event\"!=l.view&&\"list-view\"!=l.view&&\"options\"!=l.view&&\"subscription\"!=l.view||t(-1);break;case\"ArrowDown\":\"month\"==l.view&&t(7),\"add-edit-event\"!=l.view&&\"list-view\"!=l.view&&\"options\"!=l.view&&\"subscription\"!=l.view||t(1);break;case\"ArrowRight\":if(\"month\"!=l.view)return!0;t(1);break;case\"ArrowLeft\":if(\"month\"!=l.view)return!0;t(-1);break;case\"1\":D();break;case\"3\":B();break;case\"2\":w();break;case\"#\":document.querySelectorAll(\"div#calendar div#calendar-body div div [class^='moon-phase-']\").forEach(function(e){e.classList.toggle(\"active\")});break;case\"7\":break;case\"SoftRight\":case\"Alt\":if(console.log(l.view),\"month\"==l.view)return l.view=\"options\",C(),!0;if(\"subscription\"==l.view)return j(),!0;break;case\"SoftLeft\":case\"Control\":if(\"list-view\"==l.view){if(document.activeElement.classList.contains(\"subscription\"))return helper.toaster(\"a subscription cannot be edited\",2e3),!1;l.selected_day_id=document.activeElement.getAttribute(\"data-id\"),l.edit_event=!0,d(),l.view=\"add-edit-event\",C()}if(\"subscription\"==l.view)return qr.start_scan(H),!0;if(\"options\"==l.view)return W(),!0;if(\"month\"==l.view)return l.view=\"add-edit-event\",C(),h(),!0;break;case\"Enter\":if(!l.visible)return!1;if(document.activeElement.classList.contains(\"input-parent\"))return document.activeElement.children[1].focus(),!0;if(\"export-event\"==document.activeElement.id)return m.forEach(function(e){e.UID==l.selected_day_id&&o.push(e)}),eximport.export_ical(o[0].UID+\".ics\",o),helper.toaster(\"event exported\",2e3),!0;if(\"select-image\"==document.activeElement.id)return helper.pick_image(T),!0;if(\"form-image-wrapper\"==document.activeElement.id)return document.getElementById(\"form-image\").src=\"\",s=\"\",!0;if(\"add-subscription\"==document.activeElement.getAttribute(\"data-function\"))return l.view=\"subscription\",C(),!0;if(\"save-event\"==document.activeElement.id)return l.edit_event?c():r(),!0;if(\"delete-event\"==document.activeElement.id)return v()&&(l.view=\"month\",C()),!0;if(\"options\"==l.view)return\"export\"==document.activeElement.getAttribute(\"data-function\")&&localforage.getItem(\"events\").then(function(e){eximport.export_ical(\"greg.ics\",e)}).catch(function(e){console.log(e)}),\"import\"==document.activeElement.getAttribute(\"data-function\")&&eximport.loadICS(document.activeElement.getAttribute(\"data-filename\"),b),!0;\"month\"!=l.view&&\"list-view\"!=l.view||C(\"view\");break;case\"Backspace\":\"add-edit-event\"==l.view&&\"INPUT\"!=document.activeElement.tagName&&(l.view=\"month\",C()),\"options\"==l.view&&(l.view=\"month\",C()),\"scan\"==l.view&&(l.views=\"subscription\",C())}}(e)})}),document.addEventListener(\"visibilitychange\",z,!1);"},"sourceMaps":null,"error":null,"hash":"ebf8346324d64c628e0df0113a5e26a0","cacheData":{"env":{}}}