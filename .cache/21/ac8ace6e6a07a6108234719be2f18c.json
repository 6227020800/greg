{"id":"pX43","dependencies":[{"name":"/home/strukturart/Desktop/Pages/greg/package.json","includedInParent":true,"mtime":1644872416688},{"name":"/assets/js/helper.js","loc":{"line":3,"column":29,"index":128},"parent":"/home/strukturart/Desktop/Pages/greg/application/assets/js/eximport.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/assets/js/helper.js"},{"name":"../../app.js","loc":{"line":4,"column":23,"index":175},"parent":"/home/strukturart/Desktop/Pages/greg/application/assets/js/eximport.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/app.js"},{"name":"ical","loc":{"line":98,"column":23,"index":2528},"parent":"/home/strukturart/Desktop/Pages/greg/application/assets/js/eximport.js","resolved":"/home/strukturart/Desktop/Pages/greg/node_modules/ical/index.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.list_ics=exports.fetch_ics=exports.export_ical=void 0,exports.loadICS=s,exports.parse_ics=void 0;var e=require(\"/assets/js/helper.js\"),t=require(\"../../app.js\"),r=function(t,r){if(!navigator.getDeviceStorage)return!1;var n=navigator.getDeviceStorage(\"sdcard\");n.delete(t).onsuccess=function(){},setTimeout(function(){var a=\"\";a+=\"BEGIN:VCALENDAR\\r\\n\",a+=\"VERSION:2.0\\r\\n\",a+=\"PRODID:GREG\\r\\n\",a+=\"METHOD:PUBLISHED\\r\\n\",r.forEach(function(e){var t=-1;for(var r in e)0==++t&&(a+=\"BEGIN:VEVENT\\r\\n\"),\"BEGIN\"!=r&&\"END\"!=r&&\"date\"!=r&&\"time_start\"!=r&&\"time_end\"!=r&&\"dateStart\"!=r&&\"dateEnd\"!=r&&\"notification\"!=r&&\"alarm\"!=r&&\"isSubscription\"!=r&&\"multidayevent\"!=r&&\"alarmTrigger\"!=r&&\"rrule_\"!=r&&(a+=\"\".concat(r,\":\").concat(e[r])+\"\\r\\n\"),t==Object.keys(e).length-1&&(a+=\"END:VEVENT\\r\\n\")}),a+=\"END:VCALENDAR\\r\\n\";var o=new Blob([a],{type:\"text/calendar\"}),i=n.addNamed(o,t);i.onsuccess=function(){(0,e.side_toaster)(\"<img src='assets/image/E25C.svg'>\",2500)},i.onerror=function(){(0,e.toaster)(\"Unable to write the file\",2e3)}},2e3)};exports.export_ical=r;var n=function(){var t=[];(0,e.list_files)(\"ics\",function(e){t.push(e);var r=e.split(\"/\");if(\"greg.ics\"==(r=r[r.length-1]))return!1;document.querySelector(\"div#options div#import-text\").insertAdjacentHTML(\"afterend\",'<button class=\"item dynamic\" data-function=\"import\" data-filename=\"'+e+'\">'+r+\"</button>\")})};exports.list_ics=n;var a=function(r,n,a,o){var i,s,c=require(\"ical\").parseICS(r);for(var l in c)if(c.hasOwnProperty(l)){var u=c[l];if(\"VEVENT\"==c[l].type){console.log(u.start+\"/\"+u.summary);var d=!1;u.end&&u.start&&new Date(u.end).getTime()>new Date(u.start).getTime()&&(d=!0);var f=void 0,v=void 0;if(u.start){var g=new Date(u.start);f=g.getFullYear()+\"-\"+\"0\".concat(g.getMonth()+1).slice(-2)+\"-\"+\"0\".concat(g.getDate()).slice(-2),v=\"0\".concat(g.getHours()).slice(-2)+\":\"+\"0\".concat(g.getMinutes()).slice(-2)+\":\"+\"0\".concat(g.getSeconds()).slice(-2)}var p=void 0,m=void 0;if(u.end){var E=new Date(u.end);p=E.getFullYear()+\"-\"+\"0\".concat(E.getMonth()+1).slice(-2)+\"-\"+\"0\".concat(E.getDate()).slice(-2),m=\"0\".concat(E.getHours()).slice(-2)+\":\"+\"0\".concat(E.getMinutes()).slice(-2)+\":\"+\"0\".concat(E.getSeconds()).slice(-2)}var D={BEGIN:\"VEVENT\",UID:u.uid,SUMMARY:u.summary,LOCATION:u.location,DESCRIPTION:u.description,ATTACH:u.attach,RRULE:\"\",\"LAST-MODIFIED\":u.lastmodified,CLASS:u.class,DTSTAMP:u.dtstamp,DTSTART:u.start,DTEND:u.end,END:\"VEVENT\",isSubscription:o,multidayevent:d,dateStart:f,time_start:v,dateEnd:p,time_end:m,notification:\" \",alarm:\"none\",rrule_:function(){var e=\"none\";null==u.rrule&&null==u.rrule||(e=u.rrule.freq);return e}()};t.events.push(D),i=D.UID,s=D.DTSTART}}if(n(i,s),a){var T=t.events.filter(function(e){return!1===e.isSubscription});localforage.setItem(\"events\",T).then(function(t){(0,e.side_toaster)(\"<img src='assets/image/E25C.svg'>\",2500)}).catch(function(e){console.log(e)})}};exports.parse_ics=a;var o=function(t,r){var n=new XMLHttpRequest({mozSystem:!0});n.open(\"GET\",t+\"?time=\"+(new Date).getTime(),!0),n.timeout=25e3,n.onload=function(){if(n.readyState===n.DONE&&200===n.status){var t=n.response;a(t,r,!1,!0),(0,e.toaster)(\"subscriptions loaded\",2e3)}},n.onerror=function(){(0,e.toaster)(\"subscription could not be loaded\",2e3)},n.send(null)};function i(e,t){var r=new MozActivity({name:\"share\",data:{type:\"text/calendar\",number:1,blobs:[e],filenames:[t]}});r.onsuccess=function(){},r.onerror=function(){}}function s(t,r){var n=navigator.getDeviceStorage(\"sdcard\").get(t);n.onsuccess=function(){var t=this.result,n=new FileReader;n.onerror=function(t){(0,e.toaster)(\"can't read file\",3e3),n.abort()},n.onloadend=function(e){a(e.target.result,r,!0,!1)},n.readAsText(t)},n.onerror=function(){console.warn(\"Unable to get the file: \"+this.error)}}exports.fetch_ics=o;"},"sourceMaps":null,"error":null,"hash":"c0b18c46a4850e155fffa871e24e5050","cacheData":{"env":{}}}