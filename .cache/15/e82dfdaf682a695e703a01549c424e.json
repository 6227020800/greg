{"id":"A2T1","dependencies":[{"name":"/home/strukturart/Desktop/Pages/greg/package.json","includedInParent":true,"mtime":1644872416688},{"name":"localforage","loc":{"line":3,"column":24,"index":39},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/node_modules/localforage/dist/localforage.js"},{"name":"mustache","loc":{"line":4,"column":21,"index":75},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/node_modules/mustache/mustache.js"},{"name":"/assets/js/helper.js","loc":{"line":10,"column":27,"index":357},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/assets/js/helper.js"},{"name":"/assets/js/getMoonPhase.js","loc":{"line":11,"column":29,"index":410},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/assets/js/getMoonPhase.js"},{"name":"/assets/js/eximport.js","loc":{"line":15,"column":24,"index":621},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/assets/js/eximport.js"},{"name":"/assets/js/scan.js","loc":{"line":17,"column":26,"index":722},"parent":"/home/strukturart/Desktop/Pages/greg/application/app.js","resolved":"/home/strukturart/Desktop/Pages/greg/application/assets/js/scan.js"}],"generated":{"js":"\"use strict\";Object.defineProperty(exports,\"__esModule\",{value:!0}),exports.events=void 0;var e=d(require(\"localforage\")),t=d(require(\"mustache\")),n=require(\"/assets/js/helper.js\"),i=require(\"/assets/js/getMoonPhase.js\"),a=require(\"/assets/js/eximport.js\"),o=require(\"/assets/js/scan.js\");function d(e){return e&&e.__esModule?e:{default:e}}function c(e){return(c=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e})(e)}var r=[\"Jan\",\"Feb\",\"Mar\",\"Apr\",\"May\",\"Jun\",\"Jul\",\"Aug\",\"Sep\",\"Oct\",\"Nov\",\"Dec\"],l=[\"Sun\",\"Mon\",\"Tue\",\"Wed\",\"Thu\",\"Fri\",\"Sat\"],u=new Date,s=u.getMonth(),m=u.getFullYear(),v=u.getDate(),g=document.getElementById(\"monthAndYear\"),f=!1,y={view:\"month\",selected_day:\"\",visible:!1,update_event_id:\"\"},p={},E=\"\",b=[];exports.events=b;var h,w=function(e){if(!navigator.mozApps)return!1;var t=navigator.mozApps.getSelf();t.onsuccess=function(){e(t.result)},t.onerror=function(){}};function A(e){h=e.origin;var t=document.getElementById(\"KaiOsAds-Wrapper\");\"app://kaios-plus.kaiostech.com\"==e.installOrigin?document.querySelector(\"#KaiOsAds-Wrapper iframe\").src=\"ads.html\":(console.log(\"Ads free\"),t.style.display=\"none\")}w(A);var I=function(e){for(var t=0,n=new Date(e).getTime(),i=0;i<b.length;i++){n<new Date(b[i].dateStart).getTime()&&(t=b[i-1].dateStart,i=b.length),n>new Date(b[b.length-1].dateStart).getTime()&&(t=b[b.length-1].dateStart,i=b.length)}return document.querySelectorAll(\"div#list-view article[data-date='\"+t+\"']\")[0].focus(),t},B=function(e){for(var t={date:\"\",event:!1,subscription:!1,multidayevent:!1,rrule:\"none\"},n=0;n<b.length;n++)if(\"object\"===c(b[n])){t.event=!1,t.subscription=!1,t.multidayevent=!1,t.rrule=!1,t.date=e;var i=new Date(b[n].dateStart).getTime(),a=new Date(b[n].dateEnd).getTime(),o=new Date(e).getTime();\"none\"==b[n].rrule_&&(i===o||a===o||i<o&&a>o)&&(t.event=!0,!0===b[n].isSubscription&&(t.subscription=!0),!0===b[n].multidayevent&&(t.multidayevent=!0),n=b.length)}return t},D=function(e){for(var t={date:\"\",event:!1,subscription:!1,multidayevent:!1,rrule:\"none\"},n=0;n<b.length;n++)if(\"object\"===c(b[n])){t.event=!1,t.subscription=!1,t.multidayevent=!1,t.rrule=!1,t.date=e;new Date(b[n].dateStart).getTime(),new Date(b[n].dateEnd).getTime(),new Date(e).getTime();if(void 0!==b[n].rrule_&&void 0!==b[n].rrule_&&new Date(b[n].dateStart).getTime()<=new Date(e).getTime()&&new Date(e).getTime()<=new Date(b[n].dateEnd).getTime()){if(\"MONTHLY\"==b[n].rrule_&&new Date(b[n].dateStart).getDate()===new Date(e).getDate())return t.rrule=!0,n=b.length,t;if(\"DAILY\"==b[n].rrule_)return t.rrule=!0,n=b.length,t;if(\"WEEKLY\"==b[n].rrule_&&new Date(b[n].dateStart).getDay()===new Date(e).getDay())return t.rrule=!0,n=b.length,t;if(\"YEARLY\"==b[n].rrule_){var i=new Date(b[n].dateStart),a=new Date(e);if(i.getDate()+\"-\"+i.getMonth()==a.getDate()+\"-\"+a.getMonth())return t.rrule=!0,n=b.length,t}}}return t},T=[],S=0,_=function(e){T=[];var t=document.querySelector(\"div#event-slider-indicator div\");t.innerHTML=\"\";for(var n=document.querySelectorAll(\"div#event-slider article\"),i=0;i<n.length;i++){n[i].style.display=\"none\";var a=new Date(n[i].getAttribute(\"data-date\")).getTime(),o=new Date(n[i].getAttribute(\"data-date-end\")).getTime(),d=new Date(e).getTime();n[i].getAttribute(\"data-alarm\")&&\"none\"==n[i].getAttribute(\"data-alarm\")&&(n[i].querySelector(\"div.icons-bar img.bell\").style.display=\"none\");var c=n[i].getAttribute(\"data-rrule\");if(\"none\"===c||\"\"===c)(a===d||o===d||a<d&&o>d)&&(T.push(n[i]),T[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"));else if(a===d||o===d||a<d&&o>d&&c){if(\"YEARLY\"==c){var r=new Date(n[i].getAttribute(\"data-date\")),l=new Date(e);r.getDate()+\"-\"+r.getMonth()==l.getDate()+\"-\"+l.getMonth()&&(T.push(n[i]),T[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"))}\"WEEKLY\"==c&&new Date(n[i].getAttribute(\"data-date\")).getDay()==new Date(e).getDay()&&(T.push(n[i]),T[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\")),\"MONTHLY\"==c&&new Date(n[i].getAttribute(\"data-date\")).getDate()==new Date(e).getDate()&&(T.push(n[i]),T[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\")),\"DAILY\"==c&&(a===d||o===d||a<d&&o>d)&&(T.push(n[i]),T[0].style.display=\"block\",t.insertAdjacentHTML(\"beforeend\",\"<div class='indicator'></div>\"))}}\"\"!=T&&T.length>0?t.style.opacity=100:t.style.opacity=0},L=function(){var e=document.querySelectorAll(\"div#event-slider-indicator div div\");S==T.length-1&&(S=-1),S++,T.forEach(function(e){e.style.display=\"none\"}),T[S].style.display=\"block\",e.forEach(function(e){e.classList.remove(\"active\")}),e[S].classList.add(\"active\")},M=function(){var e=u.getMonth(),t=u.getFullYear();R(e,t),_(y.selected_day),y.selected_day=document.activeElement.getAttribute(\"data-date\")};function k(){m=11===s?m+1:m,R(s=(s+1)%12,m),_(y.selected_day)}function q(){m=0===s?m-1:m,R(s=0===s?11:s-1,m),_(y.selected_day)}Date.prototype.getWeek=function(){var e=new Date(this.getTime());e.setHours(0,0,0,0),e.setDate(e.getDate()+3-(e.getDay()+6)%7);var t=new Date(e.getFullYear(),0,4);return 1+Math.round(((e.getTime()-t.getTime())/864e5-3+(t.getDay()+6)%7)/7)};var R=function(e,t){(0,n.bottom_bar)(\"add\",\"events\",\"options\");var a=new Date(t,e).getDay(),o=32-new Date(t,e,32).getDate(),d=document.getElementById(\"calendar-body\");d.innerHTML=\"\",g.innerHTML=r[e]+\" \"+t;for(var c=1,l=0;l<6;l++){var s=document.createElement(\"div\");s.classList.add(\"flex\"),s.classList.add(\"row\"),s.classList.add(\"width-100\");for(var m=0;m<7;m++)if(0===l&&m<a){var f=document.createElement(\"div\"),p=document.createTextNode(\"\");f.appendChild(p),s.appendChild(f)}else{if(c>o)break;var E=document.createElement(\"div\"),h=document.createElement(\"span\"),w=document.createElement(\"div\"),A=document.createTextNode(c);E.appendChild(A),E.appendChild(h),E.setAttribute(\"tabindex\",c-1);var I=t+\"-\"+\"0\".concat(e+1).slice(-2)+\"-\"+\"0\".concat(c).slice(-2);w.classList.add(\"moon-phase-\"+(0,i.getMoonPhase)(t,e,c)),E.appendChild(w),E.setAttribute(\"data-date\",I),E.setAttribute(\"data-index\",new Date(I).toISOString()),b.length>0&&(B(I).event&&E.classList.add(\"event\"),D(I).rrule&&E.classList.add(\"event\"),1==B(I).subscription&&E.classList.add(\"subscription\")),E.classList.add(\"item\"),s.appendChild(E),c++}var T=document.createElement(\"span\");T.classList.add(\"weeknumber\");var S=document.createTextNode(new Date(t,e,c).getWeek());T.appendChild(S),s.appendChild(T),d.appendChild(s)}document.querySelectorAll(\".item\")[0].focus(),y.selected_day=document.activeElement.getAttribute(\"data-date\"),u.getMonth()==e&&u.getFullYear()==t&&(document.querySelectorAll(\".item\")[v-1].focus(),document.querySelectorAll(\".item\")[v-1].classList.add(\"today\"))},N=function(){document.querySelectorAll(\"div#list-view article\").forEach(function(e,t){e.setAttribute(\"tabindex\",t)})};function x(e){document.getElementById(\"event-slider\").style.opacity=0,(0,n.sort_array)(e,\"dateStart\",\"date\");var i=document.getElementById(\"template\").innerHTML,a=t.default.render(i,{data:e});document.getElementById(\"list-view\").innerHTML=a,document.getElementById(\"event-slider\").innerHTML=a,document.getElementById(\"event-slider\").style.opacity=100,N(),document.querySelectorAll(\"article\").forEach(function(e){var t=new Date(e.getAttribute(\"data-date\")),n=new Date(e.getAttribute(\"data-date-end\")),i=l[t.getDay()]+\", \"+t.getFullYear()+\" \"+r[t.getMonth()]+\" \"+t.getDate(),a=l[n.getDay()]+\", \"+n.getFullYear()+\" \"+r[n.getMonth()]+\" \"+n.getDate();e.classList.contains(\"multidayevent\")?e.querySelector(\"div.date\").innerText=i+\" - \"+a:e.querySelector(\"div.date\").innerText=i})}var C=function(){document.querySelectorAll(\"div#add-edit-event input\").forEach(function(e){e.value=\"\",document.getElementById(\"form-image\").src=\"\",E=\"\"})},U=document.getElementById(\"calendar\"),O=document.getElementById(\"add-edit-event\"),Y=document.getElementById(\"list-view\"),H=document.getElementById(\"options\"),j=function(){setTimeout(function(){if(\"options\"==y.view)return\"subscription\"==document.activeElement.getAttribute(\"data-function\")?((0,n.bottom_bar)(\"delete\",\"select\",\"\"),!0):((0,n.bottom_bar)(\"\",\"select\",\"\"),!0)},500)},F=document.querySelectorAll(\".page\"),z=function(e){if(F.forEach(function(e){e.style.display=\"none\"}),\"view\"==e&&(\"month\"==y.view?y.view=\"list-view\":y.view=\"month\"),\"add-edit-event\"==y.view)return document.activeElement.hasAttribute(\"data-date\")&&(y.selected_day=document.activeElement.getAttribute(\"data-date\")),document.getElementById(\"event-date\").value=y.selected_day,O.style.display=\"block\",Array.from(document.querySelectorAll(\"div#add-edit-event .item\")).forEach(function(e,t){e.setAttribute(\"tabindex\",t)}),O.querySelectorAll(\".item\")[0].focus(),(0,n.bottom_bar)(\"\",\"edit\",\"\"),\"\"==document.getElementById(\"event-date-end\").value&&(document.getElementById(\"event-date-end\").value=document.getElementById(\"event-date\").value),y.edit_event&&(document.getElementById(\"save-event\").innerText=\"update\"),console.log(y.edit_event),y.edit_event||(document.getElementById(\"save-event\").innerText=\"save\",document.getElementById(\"event-notification-time\").value=p.default_notification),!0;if(\"month\"==y.view){document.activeElement.hasAttribute(\"data-date\")&&(y.selected_day=document.activeElement.getAttribute(\"data-date\")),H.style.display=\"none\",U.style.display=\"block\",(0,n.bottom_bar)(\"add\",\"events\",\"options\"),y.edit_event=!1;var t=new Date(y.selected_day);s=t.getMonth(),m=t.getFullYear();var i=y.selected_day;R(s,m),document.querySelectorAll(\"div#calendar-body div.item\").forEach(function(e){e.getAttribute(\"data-date\")==i&&(e.focus(),_(i))}),C()}\"list-view\"==y.view&&(document.activeElement.hasAttribute(\"data-date\")&&(y.selected_day=document.activeElement.getAttribute(\"data-date\")),H.style.display=\"none\",y.edit_event=!1,C(),(0,n.bottom_bar)(\"edit\",\"month\",\"options\"),Y.style.display=\"block\",setTimeout(function(){for(var e=document.querySelectorAll(\"div#list-view article\"),t=!1,n=0;n<e.length;n++)e[n].getAttribute(\"data-date\")==y.selected_day&&(e[n].focus(),n=e.length,t=!0);for(n=0;n<e.length;n++)console.log(e[n].getAttribute(\"data-alarm\")),\"none\"==e[n].getAttribute(\"data-alarm\")&&(e[n].querySelector(\"img.bell\").style.display=\"none\");t||(document.querySelectorAll(\"div#list-view article\")[0].focus(),I(y.selected_day));var i=document.activeElement.getBoundingClientRect(),a=i.top-document.body.getBoundingClientRect().top+i.height/2;document.activeElement.parentNode.scrollBy({left:0,top:a-window.innerHeight/2,behavior:\"smooth\"})},1e3)),\"options\"==y.view&&(document.activeElement.hasAttribute(\"data-date\")&&(y.selected_day=document.activeElement.getAttribute(\"data-date\")),f||((0,a.list_ics)(),P(),f=!0),document.getElementById(\"options\").style.display=\"block\",document.querySelectorAll(\"div#options .item\")[0].focus(),document.getElementById(\"options\").style.opacity=\"1\",document.getElementById(\"subscription-form\").style.display=\"none\",setTimeout(function(){Array.from(document.querySelectorAll(\"div#options .item\")).forEach(function(e,t){e.setAttribute(\"tabindex\",t)})},2e3),j()),\"subscription\"==y.view&&(document.getElementById(\"options\").style.opacity=\"0.3\",document.getElementById(\"subscription-form\").style.display=\"block\",document.querySelectorAll(\"div#subscription-form div.item input\")[0].focus(),(0,n.bottom_bar)(\"QR\",\"\",\"save\"))},P=function(){if(null==J)return!1;J.forEach(function(e){document.querySelector(\"div#options div#subscription-text\").insertAdjacentHTML(\"afterend\",'<button class=\"item dynamic\" data-function=\"subscription\">'+e.name+\"</button>\"),document.querySelectorAll(\"div#options button\").forEach(function(e,t){e.setAttribute(\"tabindex\",t)})})},V=0,W=function e(){if(null==J||-1==J.lenght||\"undefined\"==J.lenght)return!1;V<J.length&&((0,a.fetch_ics)(J[V].url,e),V++),M(),x(b),_(document.activeElement.getAttribute(\"data-date\")),document.activeElement.hasAttribute(\"data-date\")&&(y.selected_day=document.activeElement.getAttribute(\"data-date\"))},G=function(e){(0,n.bottom_bar)(\"QR\",\"save\",\"cancel\"),y.view=\"subscription\",document.querySelector(\"div#subscription-form input#cal-subs-url\").value=e},J=new Array,K=function(){(0,n.validate)(document.getElementById(\"cal-subs-url\").value)&&\"\"!=document.getElementById(\"cal-subs-name\").value?((J=[]).push({url:document.getElementById(\"cal-subs-url\").value,name:document.getElementById(\"cal-subs-name\").value}),document.querySelector(\"input#cal-subs-name\").val=\"\",document.querySelector(\"input#cal-subs-url\").val=\"\",e.default.setItem(\"subscriptions\",J).then(function(e){document.getElementById(\"subscription-form\").style.display=\"none\",(0,n.toaster)(\"subscription stored\",2e3),y.view=\"options\",z()}).catch(function(e){console.log(e)}),W(),P()):(0,n.toaster)(\"Please enter a name and a valid url\",2e3)},Q=function(){var t=J.filter(function(e){return e.name!=document.activeElement.innerText});e.default.setItem(\"subscriptions\",t).then(function(e){console.log(\"saved: \"+e),(0,n.toaster)(\"subscription deleted\",2e3),y.view=\"month\",z()}).catch(function(e){(0,n.toaster)(e,2e3)}),document.activeElement.remove()};function X(){\"hidden\"===document.visibilityState?y.visible=!1:setTimeout(function(){y.visible=!0},1e3)}e.default.getItem(\"events\").then(function(e){null!=e&&(exports.events=b=e),x(b),M()}).catch(function(e){M()}),e.default.getItem(\"subscriptions\").then(function(e){J=e,setTimeout(function(){if(null==J)return!1;W(),console.log(J)},2e3)}).catch(function(e){console.log(e)}),e.default.getItem(\"settings\").then(function(e){if(null==e)return!1;p=e,document.getElementById(\"default-notification-time\").value=p.default_notification}).catch(function(e){console.log(e)}),X();var Z=function(e){if(\"SELECT\"==document.activeElement.nodeName||\"date\"==document.activeElement.type||\"time\"==document.activeElement.type)return!1;var t=document.activeElement.tabIndex+e,i=0;\"month\"==y.view&&(i=document.activeElement.parentNode.parentNode.querySelectorAll(\".item\"));\"list-view\"==y.view&&(i=document.activeElement.parentNode.querySelectorAll(\"div#list-view article\"));if(\"subscription\"==y.view&&(i=document.querySelectorAll(\"div#subscription-form > div.item\")),\"add-edit-event\"==y.view||\"options\"==y.view){if(i=document.activeElement.parentNode.querySelectorAll(\".item\"),document.activeElement.parentNode.classList.contains(\"input-parent\"))return document.activeElement.parentNode.focus(),!0;document.getElementById(\"add-edit-event\").firstElementChild.focus()}var a=0;t<=i.length&&(a=i[t]).focus(),t==i.length&&(a=i[0]).focus();var o=document.activeElement.getBoundingClientRect(),d=o.top-document.body.getBoundingClientRect().top+o.height/2;return document.activeElement.parentNode.scrollBy({left:0,top:d-window.innerHeight/2,behavior:\"smooth\"}),\"month\"==y.view||\"list-view\"==y.view?(a.hasAttribute(\"data-date\")&&(y.selected_day=a.getAttribute(\"data-date\"),y.selected_day_id=a.getAttribute(\"data-id\"),_(y.selected_day)),!0):\"form-image-wrapper\"==document.activeElement.id&&\"add-edit-event\"==y.view?((0,n.bottom_bar)(\"\",\"remove image\",\"\"),!0):\"form-image-wrapper\"!=document.activeElement.id&&\"add-edit-event\"==y.view?((0,n.bottom_bar)(\"\",\"edit\",\"\"),!0):void 0};document.getElementById(\"event-notification-time\").addEventListener(\"change\",function(e){setTimeout(function(){document.getElementById(\"event-notification-time\").parentElement.focus()},500)}),p.default_notification=\"none\",document.getElementById(\"default-notification-time\").addEventListener(\"change\",function(t){var n=document.getElementById(\"default-notification-time\").value;p.default_notification=n,e.default.setItem(\"settings\",p).then(function(e){}).catch(function(e){console.log(e)}),setTimeout(function(){document.getElementById(\"default-notification-time\").parentElement.focus()},500)}),document.querySelectorAll('input[type=\"time\"]').forEach(function(e){e.addEventListener(\"change\",function(t){setTimeout(function(){e.parentElement.focus()},500)})}),document.querySelectorAll('input[type=\"date\"]').forEach(function(e){e.addEventListener(\"change\",function(t){setTimeout(function(){e.parentElement.focus()},500)})});var $=function(e,t,n){if(navigator.mozAlarms){var i={foo:t,event_id:n},a=navigator.mozAlarms.add(e,\"honorTimezone\",i);a.onsuccess=function(){},a.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}},ee=function(e){if(navigator.mozAlarms){var t=navigator.mozAlarms.getAll();t.onsuccess=function(){this.result.forEach(function(t){if(t.data.event_id==e){var n=navigator.mozAlarms.remove(t.id);n.onsuccess=function(){console.log(\"removed\")},n.onerror=function(){console.log(\"An error occurred: \"+this.error.name)}}else console.log(\"no alarm founded\")})},t.onerror=function(){console.log(\"An error occurred:\",this.error.name)}}},te=function(){if(navigator.mozAlarms){var e=navigator.mozAlarms.getAll();e.onsuccess=function(){this.result.forEach(function(e){console.log(\"Id:\",e.id),console.log(\"date:\",e.date),console.log(\"respectTimezone:\",e.respectTimezone),console.log(\"data:\",JSON.stringify(e.data))})},e.onerror=function(){console.log(\"An error occurred:\",this.error.name)}}},ne=function(e){var t=e.replace(/-/g,\"\");return t=(t=t.replace(/:/g,\"\")).replace(\" \",\"T\"),t+=\"00\"},ie=[],ae=function(){var t=\"00:00:00\";\"\"!=document.getElementById(\"event-time-start\").value&&(t=document.getElementById(\"event-time-start\").value);var i=\"00:00:00\";\"\"!=document.getElementById(\"event-time-end\").value&&(i=document.getElementById(\"event-time-end\").value);var o=document.getElementById(\"event-date\").value+\" \"+t;\"\"==document.getElementById(\"event-date-end\").value&&(document.getElementById(\"event-date-end\").value=document.getElementById(\"event-date\").value);var d,c=document.getElementById(\"event-date-end\").value+\" \"+i,r=document.getElementById(\"event-notification-time\").value;\"none\"!=r&&((d=new Date(o)).setMinutes(d.getMinutes()-r),r=ne(d.toISOString()));var l=!1;new Date(document.getElementById(\"event-date\").value).getTime()!=new Date(document.getElementById(\"event-date-end\").value).getTime()&&(l=!0);var u,s,m={UID:(0,n.uid)(),SUMMARY:document.getElementById(\"event-title\").value,LOCATION:document.getElementById(\"event-location\").value,DESCRIPTION:document.getElementById(\"event-description\").value,CLASS:\"PRIVATE\",DTSTAMP:ne(o),DTSTART:ne(o),DTEND:ne(c),RRULE:(s=document.getElementById(\"event-recur\").value,\"\"==s&&\"none\"==s||(u=\"FREQ=\"+document.getElementById(\"event-recur\").value+\";UNTIL=\"+ne(c)),u),rrule_:document.getElementById(\"event-recur\").value,dateStart:document.getElementById(\"event-date\").value,dateEnd:document.getElementById(\"event-date-end\").value,time_start:document.getElementById(\"event-time-start\").value,time_end:document.getElementById(\"event-time-end\").value,alarm:document.getElementById(\"event-notification-time\").value,alarmTrigger:r,isSubscription:!1,multidayevent:l,ATTACH:E};\"none\"!=m.alarm&&(m.BEGIN=\"VALARM\",m[\"TRIGGER;VALUE=DATE-TIME\"]=r,m.ACTION=\"AUDIO\",m.END=\"VALARM\",$(d,m.SUMMARY,m.UID)),b.push(m);var v=b.filter(function(e){return!1===e.isSubscription});e.default.setItem(\"events\",v).then(function(e){C(),x(b),(0,a.export_ical)(\"greg.ics\",v)}).catch(function(e){console.log(e)}),y.view=\"month\",z()},oe=function(){b.forEach(function(e){var t,n,i=!1;if(new Date(document.getElementById(\"event-date\").value).getTime()!=new Date(document.getElementById(\"event-date-end\").value).getTime()&&(i=!0),e.UID==y.selected_day_id){var a=\"00:00:00\";\"\"!=document.getElementById(\"event-time-start\").value&&(a=document.getElementById(\"event-time-start\").value);var o=\"00:00:00\";\"\"!=document.getElementById(\"event-time-end\").value&&(o=document.getElementById(\"event-time-end\").value);var d=document.getElementById(\"event-date\").value+\" \"+a,c=document.getElementById(\"event-date\").value+\" \"+o,r=document.getElementById(\"event-notification-time\").value,l=\"\";\"none\"!=r&&((l=new Date(d)).setMinutes(l.getMinutes()-r),r=ne(l.toISOString()));e.SUMMARY=document.getElementById(\"event-title\").value,e.DESCRIPTION=document.getElementById(\"event-description\").value,e.LOCATION=document.getElementById(\"event-location\").value,e.DTSTART=ne(d),e.DTEND=ne(c),e.dateEnd=document.getElementById(\"event-date-end\").value,e.dateStart=document.getElementById(\"event-date\").value,e.time_start=document.getElementById(\"event-time-start\").value,e.time_end=document.getElementById(\"event-time-end\").value,e.RRULE=(\"\"==(n=document.getElementById(\"event-recur\").value)&&\"none\"==n||(t=\"FREQ=\"+document.getElementById(\"event-recur\").value+\";UNTIL=\"+ne(c)),t),e.rrule_=document.getElementById(\"event-recur\").value,e.isSubscription=!1,e.multidayevent=i,e.alarm=document.getElementById(\"event-notification-time\").value,e.alarmTrigger=r,\"\"!=E&&(e.ATTACH=E),\"none\"!=e.alarm&&(ee(e.UID),e.BEGIN=\"VALARM\",e[\"TRIGGER;VALUE=DATE-TIME:\"]=r,e.ACTION=\"AUDIO\",e.END=\"VALARM\",$(l,e.SUMMARY,e.UID))}});var t=b.filter(function(e){return!1===e.isSubscription});e.default.setItem(\"events\",t).then(function(e){x(b),(0,a.export_ical)(\"greg.ics\",e),y.view=\"month\",z(),C()}).catch(function(e){})},de=function(){document.getElementById(\"delete-event\").style.display=\"block\",document.getElementById(\"export-event\").style.display=\"block\",b.forEach(function(e){e.UID==y.selected_day_id&&(document.getElementById(\"event-title\").value=e.SUMMARY,document.getElementById(\"event-date\").value=e.dateStart,document.getElementById(\"event-date-end\").value=e.dateEnd,document.getElementById(\"event-time-start\").value=e.time_start,document.getElementById(\"event-time-end\").value=e.time_end,document.getElementById(\"event-description\").value=e.DESCRIPTION,document.getElementById(\"event-location\").value=e.LOCATION,document.querySelector(\"#event-notification-time\").value=e.alarm,document.getElementById(\"form-image\").src=e.ATTACH,document.getElementById(\"event-recur\").value=e.rrule_)})},ce=function(){exports.events=b=b.filter(function(e){return e.UID!=y.selected_day_id}),ee(y.selected_day_id),y.edit_event=!1;var t=b.filter(function(e){return!1===e.isSubscription});return C(),e.default.setItem(\"events\",t).then(function(e){x(b),(0,a.export_ical)(\"greg.ics\",e)}).catch(function(e){console.log(e)}),!0},re=new Date,le=\"0\".concat(re.getMonth()+1).slice(-2),ue=\"0\".concat(re.getDate()).slice(-2),se=re.getFullYear();_(se+\"-\"+le+\"-\"+ue);var me,ve=function(t,i){(0,n.toaster)(\"done\",2e3),(0,n.bottom_bar)(\"edit\",\"\",\"\");var o=b.filter(function(e){return!1===e.isSubscription});e.default.setItem(\"events\",o).then(function(e){x(b),(0,a.export_ical)(\"greg.ics\",o)}).catch(function(e){})},ge=function(){var e=new Date,t=\"0\".concat(e.getHours()).slice(-2)+\":\"+\"0\".concat(e.getMinutes()).slice(-2),n=\"0\".concat(e.getHours()+1).slice(-2);n>23&&(n=\"23\");var i=n+\":\"+\"0\".concat(e.getMinutes()).slice(-2);document.getElementById(\"event-time-start\").value=t,document.getElementById(\"event-time-end\").value=i},fe=function(e){document.getElementById(\"form-image\").src=URL.createObjectURL(e),document.getElementById(\"form-image-wrapper\").classList.add(\"item\"),document.querySelectorAll(\"div#add-edit-event .item\").forEach(function(e,t){e.setAttribute(\"tabindex\",t)});var t=new FileReader;t.onload=function(){E=t.result},t.readAsDataURL(e)},ye=!1,pe=1e3;function Ee(e){e.key}function be(e){switch(e.key){case\"0\":break;case\"Backspace\":window.close();break;case\"ArrowLeft\":y.view}}function he(t){switch(t.key){case\"*\":M();break;case\"ArrowUp\":\"month\"==y.view&&Z(-7),\"add-edit-event\"!=y.view&&\"list-view\"!=y.view&&\"options\"!=y.view&&\"subscription\"!=y.view||Z(-1);break;case\"ArrowDown\":\"month\"==y.view&&Z(7),\"add-edit-event\"!=y.view&&\"list-view\"!=y.view&&\"options\"!=y.view&&\"subscription\"!=y.view||Z(1);break;case\"ArrowRight\":if(\"month\"!=y.view)return!0;Z(1);break;case\"ArrowLeft\":if(\"month\"!=y.view)return!0;Z(-1);break;case\"1\":q();break;case\"3\":k();break;case\"2\":L();break;case\"#\":document.querySelectorAll(\"div#calendar div#calendar-body div div [class^='moon-phase-']\").forEach(function(e){e.classList.toggle(\"active\")});break;case\"7\":break;case\"SoftRight\":case\"Alt\":if(console.log(y.view),\"month\"==y.view)return y.view=\"options\",z(),!0;if(\"subscription\"==y.view)return K(),!0;break;case\"SoftLeft\":case\"Control\":if(\"list-view\"==y.view){if(document.activeElement.classList.contains(\"subscription\"))return(0,n.toaster)(\"a subscription cannot be edited\",2e3),!1;y.selected_day_id=document.activeElement.getAttribute(\"data-id\"),y.edit_event=!0,de(),y.view=\"add-edit-event\",z()}if(\"subscription\"==y.view)return(0,o.start_scan)(G),y.view=\"scan\",!0;if(\"options\"==y.view)return Q(),!0;if(\"month\"==y.view)return y.view=\"add-edit-event\",z(),ge(),!0;break;case\"Enter\":if(!y.visible)return!1;if(document.activeElement.classList.contains(\"input-parent\"))return document.activeElement.children[1].focus(),!0;if(\"export-event\"==document.activeElement.id)return b.forEach(function(e){e.UID==y.selected_day_id&&ie.push(e)}),(0,a.export_ical)(ie[0].UID+\".ics\",ie),(0,n.toaster)(\"event exported\",2e3),!0;if(\"select-image\"==document.activeElement.id)return(0,n.pick_image)(fe),!0;if(\"form-image-wrapper\"==document.activeElement.id)return document.getElementById(\"form-image\").src=\"\",E=\"\",!0;if(\"add-subscription\"==document.activeElement.getAttribute(\"data-function\"))return y.view=\"subscription\",z(),!0;if(\"save-event\"==document.activeElement.id)return y.edit_event?oe():ae(),!0;if(\"delete-event\"==document.activeElement.id)return ce()&&(y.view=\"month\",z()),!0;if(\"options\"==y.view)return\"export\"==document.activeElement.getAttribute(\"data-function\")&&e.default.getItem(\"events\").then(function(e){(0,a.export_ical)(\"greg.ics\",e)}).catch(function(e){console.log(e)}),\"import\"==document.activeElement.getAttribute(\"data-function\")&&(0,a.loadICS)(document.activeElement.getAttribute(\"data-filename\"),ve),!0;\"month\"!=y.view&&\"list-view\"!=y.view||z(\"view\");break;case\"Backspace\":\"add-edit-event\"==y.view&&\"INPUT\"!=document.activeElement.tagName&&(y.view=\"month\",z()),\"options\"==y.view&&(y.view=\"month\",z()),\"scan\"==y.view&&(y.views=\"subscription\",(0,o.stop_scan)(),z())}}function we(e){j(),\"Backspace\"===e.key&&(\"options\"!=y.view&&\"add-edit-event\"!=y.view&&\"scan\"!=y.view||e.preventDefault()),\"EndCall\"===e.key&&(e.preventDefault(),window.close()),e.repeat||(ye=!1,me=setTimeout(function(){ye=!0,be(e)},pe)),e.repeat&&(\"Backspace\"==e.key&&(ye=!1),Ee(e))}function Ae(e){if(!1===y.visible)return!1;\"Backspace\"==e.key&&document.activeElement.tagName,clearTimeout(me),ye||he(e)}document.addEventListener(\"keydown\",we),document.addEventListener(\"keyup\",Ae),document.addEventListener(\"visibilitychange\",X,!1);"},"sourceMaps":null,"error":null,"hash":"d446561c0e81b9102271647c24d40b42","cacheData":{"env":{}}}